
\newcommand{\fCYL}   {\emath{f^{Cyl}}}
\newcommand{\fCII}   {\emath{f^{Cyl \times 2}}}
\newcommand{\fPL}    {\emath{f^{Pl}}}
\newcommand{\fPLII}  {\emath{f^{Pl \times 2}}}
\newcommand{\fANN}   {\emath{f^{Ann}}}
\newcommand{\fCN}    {\emath{f^{Cone}}}
\newcommand{\fSCN}   {\emath{f^{SCone}}}
\newcommand{\fTCN}   {\emath{f^{TCone}}}
\newcommand{\fFR}    {\emath{f^{Fr}}}
\newcommand{\fX}     {\emath{f^{X}}}
\newcommand{\fCAN}   {\emath{f^{Can}}}
\newcommand{\NneqII} {\emath{N_{\neq 2}}}


% Figure on test data sets isosurfaces placed in shrec_angle_distance.tex
% so that it appears in appropriate place in the text.


\begin{figure*}
\centering
\begin{tabular}{cccc}
\includegraphics[width=1.6in]{images/twocubes_mesh.eps} &
\includegraphics[width=1.6in]{images/flange_mesh.eps} &
\includegraphics[width=1.6in]{images/smooth_tip_cone_mesh.eps} &
\includegraphics[width=1.6in]{images/cannon_mesh.eps}
\\
(a) TwoCubes & (b) Flange & (c) Smooth Tip Cone & (d) Cannon \\
\end{tabular}
\caption{Polygonal meshes representing level sets.}
\label{fig:mesh}
\end{figure*}

\section{Experimental Results on Synthetic Data}\label{sec:synData}
\label{section:results}

\subsection{Synthetic Scalar and Gradient Data}
\label{section:synthetic}

To measure the quality of our reconstruction,
we used a number of synthetic scalar and gradient datasets.
(See Figure~\ref{fig:synthetic_data}.)
Given a point $p$,
let $f^{L_1}_{p}(q)$ be the $L_1$ distance from $p$ to $q$.
A {\em Cube} dataset is generated by sampling $f^{L_1}_p$
and its gradients on vertices of the regular grid.

Level sets of $f^{L_1}_p$ are cubes whose edges are
parallel to the coordinate axes
and whose facets are orthogonal to those axes.
By rotating $f^{L_1}_p$ around $p$, 
we can generate a scalar field whose level sets are cubes
that are not axis-aligned.
By taking the minimum of two (rotated) scalar fields, 
$f^{L_1}_p$ and $f^{L_1}_{p'}$, 
centered around two different points, $p$ and $p$', respectively,
we get a scalar field whose level sets are the boundaries
of the unions of the two cubes.
(See Figure~\ref{fig:synthetic_data}(a).)
We call a regular grid sampling of such a scalar field
and its gradients a {\em TwoCubes} dataset.
The isosurface of a TwoCubes dataset has twenty 0-dimensional features,
fourteen of which are cube corners and six of which are ``saddle points''
where the two boundaries of two cubes meet.
We use the TwoCubes datasets with various rotations
as test sets for the reconstruction of 0-dimensional features.

Let $\ell$ be a line.
Let $\fCYL_{\ell}(q)$ be the Euclidean distance from point $q$ to $\ell$.
The level sets of $\fCYL_{\ell}(q)$ are infinite cylinders around $\ell$.
Let $\fCII_{\ell,r}(q)$ equal $|\fCYL_{\ell}(q) - r|$.
The level sets of $\fCII_{\ell,r}(q)$  are pairs of infinite cylinders
at equal distances from the cylinder of radius $r$ around $\ell$.
Let $\fPLII_{p,\ell}(q)$ be the (unsigned) distance from $q$ to the plane
that contains point $p$ and is orthogonal to line $\ell$.
Let $\fANN_{p,\ell,r}(q)$ be the maximum 
of $\fCII_{\ell,r}(q)$ and of $\fPLII_{p,\ell}(q)$.
The level sets are the boundaries of thickened annuli.
(See Figure~\ref{fig:synthetic_data}(b).)

The width of the thickened annuli defined by $\fANN_{p,\ell,r}$
equals their height.
We can adjust change the difference between the width and height
by adding constants to $\fCII_{\ell,r}$ or $\fPLII_{p,\ell}(q)$.
Let $\fANN_{p,\ell,r,c_1,c_2}(q)$ be the maximum 
of $\fCII_{\ell,r}(q)+c_1$ and of $\fPLII_{p,\ell}(q)+c_2$.
If $c_1$ is greater than $c_2$, 
then the height is $c_1-c_2$ units greater than the width.
If $c_2$ is greater than $c_1$, 
then the width is $c_2-c_1$ units greater than the height.

Define $\fFR_{p,\ell,r,c}(q)$ as the minimum
of $\fANN_{p,\ell,r,c,0}(q)$ and $\fANN_{p,\ell,r,0,c}(q)$.
The level sets of $\fFR_{p,\ell,r,c}(q)$ are the boundaries
of the unions of two thickened annuli.
(See Figure~\ref{fig:synthetic_data}(c).)
One annuli has height $c$ units greater than its width
while the other has width $c$ units greater than its height.
A {\em Flange} dataset is a regular grid sampling of $\fFR_{p,\ell,r,c}(q)$
and its gradients.
The Flange dataset has no 0-dimensional features.
We use the Flange datasets as test sets
for the reconstruction of 1-dimensional features.

We use two other types of datasets to test our algorithm on dihedral
angles other than $90^\circ$.
A cone is defined by an apex $p$, an axis direction $\zeta$,
and an angle $\alpha < 90^\circ$.
The cone is the union of all the rays from $p$ forming angle $\alpha$
with $\zeta$.
Let $\ell$ be the directed line through $p$ with direction $\zeta$,
i.e. the cone axis.
Let $\pi_{\ell}(q)$ be the projection of point $q$ on $\ell$.
Let $D_1(q)$ be the distance from $p$ to $\pi_{\ell}(q)$
and let $D_2(q)$ be the signed distance from $\pi_{\ell}(q)$ to $p$.
(The distance is negative if $\pi_\ell(q)-p$ points in the opposite
direction from $\zeta$.)
Define $\fCN_{p,\zeta,\alpha}(q)$ 
as $\cos(\alpha) D_1(q) - \sin(\alpha) D_2(q)$.
Function $\fCN_{p,\zeta,\alpha}(q)$ is the signed distance
from point $q$ to its orthogonal projection on the cone,
when that orthogonal projection exists.
The level sets of $\fCN_{p,\zeta,\alpha}(q)$ are cones
with axis $\ell$.

We truncate the cone by defining a plane orthogonal to $\ell$.
Let $p'$ be a point on ray $p+t\zeta$
where $\zeta$ is a unit vector.
Let $\fPL_{p',\zeta}(q)$ equal $(q-p') \cdot \zeta$,
the (unsigned) distance from $q$ 
to the plane containing $p'$ orthogonal to $\zeta$.
Define
\begin{equation*}
\fFR_{p,\zeta,\alpha,p'}(q) = 
\max \left ( \fCN_{p,\zeta,\alpha}(q), \fPL_{p',\zeta}(q), \fPL_{p',-\zeta}(q)
\right ) .
\end{equation*}
The level sets of $\fFR_{p,\zeta,\alpha,p'}(q)$ are frustra.
(See Figure~\ref{fig:synthetic_data}(d).)

The level sets of $\fFR_{p,\zeta,\alpha,p'}(q)$
have two closed curves forming 1-dimensional features.
The dihedral angle on one of these curves is $90^\circ + \alpha$
while the dihedral angle on the other is $90^\circ - \alpha$.
To generate a field with dihedral angles of $90^\circ + \alpha$
or $90^\circ - \alpha$, but not both,
we modify $\fFR_{p,\zeta,\alpha,p'}(q)$ so that the level sets
are capped by spheres at one end.

Define
\begin{align*}
\fSCN_{p,\zeta,\alpha,p'}(q) & =
\left \{
\begin{array}{ll}
|q-p'| & \mbox{ if } \angle(q,p',p) \le 90^\circ - \alpha,\\
\fCN_{p,\zeta,\alpha}(q) & \mbox{ if } 
  \angle(q,p',p) > 90^\circ - \alpha,
\end{array}
\right .
\\
\fTCN_{p,\zeta,\alpha}(q) & = 
\max \left ( \fSCN_{p,\zeta,\alpha,p'}(q), \fPL_{p',\zeta} \right ).
\end{align*}

A level set of $\fSCN_{p,\zeta,\alpha,p'}(q)$ is a cone
with its tip smoothed.
A level set of $\fSCN_{p,\zeta,\alpha,p'}(q)$ is a truncated cone
with its tip smoothed.
The level set has a single closed curve forming a 1-dimensional feature
with dihedral angle $90^\circ - \alpha$.
The {\em Smooth Tip Cone} dataset is a regular sampling
of $\fTCN_{p,\zeta,\alpha,p'}(q)$ and its gradients.
We use Smooth Tip Cone datasets to evaluate reconstruction
of dihedral angles less than $90^\circ$.

Let $p'$ and $p''$ be points on the ray $p + t \zeta$ where
$|p-p'|$ is less than $(1-\sin(\alpha)) |p-p''|$.
Define
\begin{align*}
\fX_{p,\zeta,\alpha,p''}(q) & =
\left \{
\begin{array}{ll}
|q-p''| & \mbox{ if } \angle(q,p',p) > 90^\circ - \alpha,\\
\fCN_{p,\zeta,\alpha}(q) & \mbox{ if } \angle(q,p',p) \le 90^\circ - \alpha.
\end{array}
\right .
\\
\fCAN_{p,\zeta,\alpha,p',p''}(q) & =
\max \left ( \fX_{p,\zeta,\alpha,p''}(q), \fPL_{p',-\zeta} \right ) .
\end{align*}

A level set of $\fCAN_{p,\zeta,\alpha,p'}(q)$ has the shape of a cannon.
The level set has a single closed curve forming a 1-dimensional feature
with dihedral angle $90^\circ + \alpha$.
The {\em Cannon} dataset is a regular sampling
of $\fCAN_{p,\zeta,\alpha,p'}(q)$ and its gradients.
We use Cannon datasets to evaluate reconstruction
of dihedral angles greater than $90^\circ$.



\begin{table*}[t]
\centering
\begin{tabular}{|l||r|c|c|r|r|r|r|}
\hline
              & \centercol{Num} & & & \centercol{Avg Num} 
                                     & \centercol{Avg Num} 
                                         & \centercol{Avg Num} & \\
Dataset Type & Datasets & Grid Size & Isovalue 
                                 & \centercol{Active Cubes} 
                                    & \centercol{Iso Vert} 
                                        & \centercol{Iso Tri} 
                                             & \centercol{Avg Time} \\
\hline
\hline
TwoCubes & 34 & \gDim{150} & 20.1 & 25K & 22K & 45K & 0.8 sec \\
\hline
Flange & 39 & \gDim{200} & 10.1 & 90K & 75K & 150K & 1.8 sec \\
\hline
Smooth Tip Cone & 15 & \gDim{100} & 10.2 & 4K & 3.5K & 7K & 0.2 sec \\
\hline
Cannon & 15 & \gDim{100} & 0.0 & 7K & 7K & 14K & 0.2 sec \\
\hline
\end{tabular}

\caption{Synthetic test dataset sizes, isovalues, and average statistics
on isosurfaces produced by SHREC.
Average number of active cubes, 
average number of isosurface vertices,
average number of isosurface triangles,
and average SHREC running time.
All isosurface quadrilaterals are triangulated
before counting the number of isosurface triangles.
Because SHREC merges isosurface vertices, the average number of isosurface
vertices is less than the average number of active cubes.
}

\label{table:datasets}

\end{table*}

\subsection{Gradients}

Algorithm SHREC requires gradients at the grid vertices.
Exact formulas can be given for gradients
for each of the scalar fields described in the previous section.
However, if scalar data is acquired from scanning devices such as CT scanners,
only scalar information is available.
In~\cite{bw-crgsd-15},
we describe an algorithm, Religrad, for constructing a set 
of reliable gradients from scalar data.
We evaluated SHREC both on gradients computed by exact formulas
and on the gradients produced by Religrad from the scalar data.

\subsection{Measurements}
\label{section:measure}

For each test scalar field $f$ and test isovalue $\sigma$,
we constructed a polygonal mesh which represented the level set,
$f^{-1}(\sigma)$.
(See Figure~\ref{fig:mesh}.)
The polygonal mesh was designed specifically for each surface
to accurately represent the 0-dimensional and 1-dimensional features
on the surface.

To compare isosurfaces constructed by different software on different scales,
we rescaled every isosurface and polygonal mesh to lie in the unit cube.
Our isosurfaces were computed from grids 
of $150 \times 150 \times 150$ or $200 \times 200 \times 200$
so this rescaled the cube size to about $0.005$ units.
We computed the angular distance in the extended $\epsilon$-neighborhood
as defined in Section~\ref{section:angular_distance}
between each isosurface and the corresponding polygonal mesh.
We also computed the number of triangles whose normals differed
by more than $30$, $40$ or $50$ degrees from polyhedral triangles
in the extended $\epsilon$-neighborhood around each triangle.
We set $\epsilon$ equal to $0.01$ or about twice the cube size
for the extended neighborhood.

We also used the degree test as described in~\cite{bw-cisec-13}
to measure errors in reconstructing sharp features.
We extracted the 1-skeleton of isosurface edges with dihedral angle 
less than $140^\circ$ and counted the number of vertices in the 1-skeleton
with degree other than two.
For an isosurface $\Sigma$,
let $\NneqII(\Sigma)$ be the number of vertices in the 1-skeleton
with degree other than two.
Isosurfaces from the Flange, Smooth Tip Cone and Cannon datasets
should have had zero vertices with degrees other than two.
The number of degree errors for these isosurfaces is $\NneqII(\Sigma)$.
Isosurfaces from the TwoCubes datasets should have had exactly
twenty vertices with degrees other than two.
The number of degree errors for these isosurfaces is $|\NneqII(\Sigma)-20|$.

\begin{figure}[t]
\includegraphics[width=\linewidth]{images/shrecFlangeCombine2.eps}
\caption{SHREC Flange isosurface. ``Sharp" edges (with dihedral angle less than $140^\circ$) are marked in red. 
``Smooth" edges are in dark gray. The magnified region shows a blend of the ``sharp" edges with a subset of the ``smooth" edges.}
\label{fig:flange1}
\end{figure}

\suppressfloats

\begin{figure}[t]
	\includegraphics[width=\linewidth]{images/shrecPerfect.eps}
	\caption{SHREC TwoCubes isosurface. 
``Sharp" edges (dihedral angle less than $140^\circ$) are marked in red. 
Smooth edges are shown in cyan. The magnified region shows the output mesh edges around a corner.}
	\label{fig:shrecPerfect1}
\end{figure}

\begin{figure*}[p]
\centering	

\begin{tabular}{cc}
	\subfloat[Flange: Oriented angle distance]{\includegraphics[width=0.45\linewidth]{images/flange_maxAngle_shrec.eps}\label{fig:shrec:flange:A}} 
\qquad & \qquad
\subfloat[Flange: Degree errors]{\includegraphics[width=0.45\linewidth]{images/flange_countDegree_shrec.eps}\label{fig:shrec:flange:D}} \\
\\
	\subfloat[TwoCubes: Oriented angle distance]{\includegraphics[width=0.45\linewidth]{images/twoCube_maxAngle_shrec.eps}\label{fig:shrec:twocubes:A}}
\qquad & \qquad
	\subfloat[TwoCubes: Degree errors]{\includegraphics[width=0.45\linewidth]{images/twoCube_countDegree_shrec.eps}\label{fig:shrec:twocubes:D}} \\
\\
	\subfloat[Flange: Triangle normal differences]{\includegraphics[width=0.4\linewidth]{images/flange_shrec_distribution.eps}\label{fig:shrec:flange:N}}
\qquad & \qquad
	\subfloat[TwoCubes: Triangle normal differences]{\includegraphics[width=0.4\linewidth]{images/twoCube_shrec_distribution.eps}\label{fig:shrec:twocubes:N}}
\end{tabular}

\caption{Results of SHREC using exact gradients and Religrad gradients on 39 Flange datasets and 34 TwoCubes datasets.
(a) Oriented angle distances between Flange isosurfaces
(exact and Religrad gradients) and polygonal mesh.
(b) Number of degree errors in the Flange 1-skeletons of sharp edges
(Religrad gradients).
(SHREC using exact gradients produces no degree errors.)
(c) Oriented angle distances between TwoCubes isosurfaces
(exact and Religrad gradients) and polygonal mesh.
(d) Number of degree errors in the TwoCubes 1-skeletons of sharp edges
(Religrad gradients).
(SHREC using exact gradients produces no degree errors.)
(e) Number of Flange isosurface triangles with normal difference 
to polygonal mesh above 30, 40 and 50 degrees. 
(f) Number of TwoCubes isosurface triangles with normal difference
to polygonal mesh above 30, 40 and 50 degrees.
}
\label{fig:shrecResults}

\end{figure*}


\subsection{Isosurface Reconstruction on Synthetic Data}
\label{section:synthetic_tests}

We tested SHREC on 39 Flange datasets with 39 different orientations
and 34 TwoCubes datasets with 34 different orientations.
Table~\ref{table:datasets} presents dataset sizes, isovalues,
and average isosurface sizes.
We tested SHREC both on gradients produced by exact formulas 
and on gradients produced by Religrad.
We measured the oriented angle distance between the SHREC isosurfaces
and the polygonal meshes representing the level sets.
We also counted the number of isosurface triangles whose normal differences
from the polyhedral mesh were above $30^\circ$, $40^\circ$ and $50^\circ$.
Finally, we measured the number of degree errors 
in the 1-skeleton of sharp isosurface edges.

Figure~\ref{fig:flange1} shows a Flange isosurface produced by SHREC
using exact gradients.
The magnified region shows edges with dihedral angle
less than $140^\circ$ in red blended with a subset of the ``non-sharp"
edges.

Figure~\ref{fig:shrecPerfect1} shows a TwoCubes isosurface
and isosurface edges constructed by SHREC.
SHREC reproduces the 0-dimensional features with single mesh vertices
and the 1-dimensional features with a sequence of mesh edges
with dihedral angle $90^\circ$.

With exact gradients,
all the Flange isosurfaces had oriented angle distance
under 15 degrees from the polygonal meshes.
They also had no degree errors in the 1-skeletons
of sharp isosurface edges,
i.e. all the vertices in the 1-skeletons had degree two.

Figure~\ref{fig:shrecResults} displays oriented angle distance and degree error
information for the 39 Flange isosurfaces
when gradients were produced using Religrad.
As shown in Figure~\subref*{fig:shrec:flange:N},
only one isosurface had triangles with angle distance greater than $50^\circ$
and more than half had no triangles with angle distance greater than $40^\circ$.
No isosurfaces had more than 5 triangles with angle distance
greater than $40^\circ$
and no isosurfaces had more than 15 triangles with angle distance greater
than $30^\circ$.

Figure~\protect\subref*{fig:shrec:flange:D} shows the 1-skeleton degree errors
for the 39 Flange isosurfaces when gradients were produced using Religrad.
Thirteen isosurfaces had no degree errors.
No isosurface had more than fourteen degree errors.

Figure~\ref{fig:shrecResults} displays angle distance and degree error
information for the 34 TwoCubes isosurfaces produced by SHREC.
Figure~\subref*{fig:shrec:twocubes:A} shows the oriented angle distance
using exact gradients and Religrad gradients.
As with the exact gradients in the Flange datasets,
the angle distance is very low (less than $5^\circ$)
for all the TwoCubes isosurfaces produced using exact gradients.
For most isosurfaces produced using Religrad gradients, 
the angle distance is still low (under $15^\circ$),
although six isosurfaces have angle distances above $30^\circ$.
The high angle distances indicate errors in the SHREC reconstruction 
of sharp features.

Figure~\subref*{fig:shrec:twocubes:N} gives
the number of TwoCubes Religrad isosurface triangles 
whose normal differences to the polyhedral mesh 
are above $30^\circ$, $40^\circ$ and $50^\circ$.
No isosurface has more than 10 triangles with normal difference
above $30^\circ$.

With exact gradients, the 34 TwoCubes isosurfaces 
had no 1-skeleton degree errors, 
i.e. they all had exactly 20 vertices with degree three 
in the 1-skeleton of their sharp edges.
Figure~\subref*{fig:shrec:twocubes:D} shows
the degree errors in the 1-skeleton of sharp edges
when gradients were produced using Religrad.
29 out of the 34 TwoCubes isosurfaces had no degree errors.
Of the 5 isosurfaces with degree errors,
the maximum number of degree errors was four.

\begin{figure}[t]
\subfloat[Cannon]{\includegraphics[width=0.5\linewidth]{images/cannon2.eps}\label{fig:cannon:a}}
\subfloat[Smooth Tip Cone]{\includegraphics[width=0.5\linewidth]{images/cone2.eps}\label{fig:cone:a}}
\caption{SHREC Cannon and Smooth Tip Cone isosurfaces (Religrad gradients.) 
(a)~Cannon isosurface.
\mbox{1-dimensional} feature has dihedral angle $120^\circ$.
(b)~Smooth Tip Cone isosurface.  1-dimensional feature has dihedral angle $60^\circ$.}
\label{fig:cannon_cone}
\end{figure}

\begin{figure}[t]
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cannon.eps}\label{fig:cannon:b}}
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cone.eps}\label{fig:cone:b}}

\caption{Results of SHREC on 15 Cannon and 14 Smooth Tip Cone datasets.
(a) Number of degree errors on 1-skeleton of Cannon isosurfaces
constructed using Religrad gradients.
(Cannon isosurfaces constructed using exact gradients had no degree errors.)
(b) Number of degree errors on 1-skeleton of Smooth Tip Cone isosurfaces
constructed using Religrad gradients (green) and exact gradients (red).}
\label{fig:cannon_cone_summary}
\end{figure}

\begin{table*}[t]
\centering
\begin{tabular}{|l|l|l|c|}
\hline
Software & Algorithm & URL & References \\
\hline
EMC (IsoEx) & Extended Marching Cubes &
\href{https://www.graphics.rwth-aachen.de/software}{www.graphics.rwth-aachen.de/software} & \cite{kbsh-fssev-01} \\
\hline
EMCpoly & Extended Marching Cubes &
\href{http://web.cse.ohio-state.edu/research/graphics/isotable}{web.cse.ohio-state.edu/research/graphics/isotable} & \\
\hline
PolyMender & Dual Contouring &
\href{http://www.cse.wustl.edu/~taoju/code/polymender.htm}{www.cse.wustl.edu/~taoju/code/polymender.htm} & \cite{j-rrpm-04,jlsw-dchd-02,sw-dcss-02} \\
\hline
SingularCocone & &
\href{http://web.cse.ohio-state.edu/~tamaldey/cocone.html}{web.cse.ohio-state.edu/~tamaldey/cocone.html} & \cite{cdr-drpsc-07,Dey2012,Dey2013} \\
\hline
MergeSharp & &
\href{http://web.cse.ohio-state.edu/research/graphics/isotable}{web.cse.ohio-state.edu/research/graphics/isotable} & \cite{bw-cisec-13,bw-erm-13}\\
\hline
SHREC & &
\href{http://web.cse.ohio-state.edu/research/graphics/isotable}{web.cse.ohio-state.edu/research/graphics/isotable} & \\
\hline
\end{tabular}

\caption{Surface reconstruction software.
EMC is a sample implementation of Extended Marching Cubes.
EMCpoly is a modification of EMC which creates TwoCubes and Flange isosurfaces.
PolyMender is an implementation of dual contouring for fixing polygonal meshes.
SingularCocone is an implementation of a Voronoi based algorithm
for surface reconstruction from point clouds.
The algorithm handles 0 and 1 dimensional features
including non-manifold features.
MergeSharp is an implementation of a dual contouring reconstruction algorithm 
which uses cube merging to obtain better reconstruction around sharp features.
SHREC is an implementation of the algorithm in this paper.}
\label{table:software}
\end{table*}

To measure the dihedral angles other than $90^\circ$,
we ran SHREC on 15 Cannon datasets with 15 different orientations
and 14 Smooth Tip Cone datasets with 14 different orientations.
The 1-dimensional features in the Cannon level sets
had dihedral angles of $60^\circ$.
The 1-dimensional features in the Smooth Tip Cone level sets
had dihedral angles of $120^\circ$.
As expected, SHREC produced more errors than on the Flange or TwoCubes
datasets, although it still did quite well.

Figure~\ref{fig:cannon_cone} shows Cannon and Smooth Tip Cone isosurfaces
produced by SHREC using Religrad gradients.
In each, the 1-dimensional is represented by a sequence 
of isosurface mesh edges with the appropriate dihedral angles.

Figure~\ref{fig:cannon_cone_summary} gives the number of degree errors
in the 1-skeleton of sharp edges
for Cannon and Smooth Tip Cone isosurfaces.
SHREC using exact gradients produced no degree errors 
on the 15 Cannon datasets.
SHREC using Religrad produced degree errors on only four Cannon datasets.
For each dataset, there were exactly two degree errors.
SHREC using exact gradients produced degree errors in only two 
of the Smooth Tip Cone datasets,
one with two errors and one with four.
SHREC using Religrad gradients produced degree errors on 7 out of the 14
Smooth Tip Cone datasets.
The maximum number of degree errors in any Smooth Tip Cone isosurface
was 4.



\begin{figure*}[p]
\centering

\begin{tabular}{cc}
	\subfloat[Flange: Oriented angle distance]{\includegraphics[width=0.45\linewidth]{images/ms_euro_flange_maxAngle.eps}\label{fig:msharp:flange:A}} &
	\subfloat[Flange: Degree errors]{\includegraphics[width=0.45\linewidth]{images/ms_euro_flange_countDegree.eps}\label{fig:msharp:flange:D}} \\
	\subfloat[TwoCubes: Oriented angle distance]{\includegraphics[width=0.45\linewidth]{images/ms_euro_twoCube_maxAngle.eps}\label{fig:msharp:tc:A}} &
	\subfloat[TwoCubes: Degree errors]{\includegraphics[width=0.45\linewidth]{images/ms_euro_twoCube_countDegree.eps}\label{fig:msharp:tc:D}} \\
	\subfloat[Flange: Triangle normal differences]{\includegraphics[width=0.45\linewidth]{images/ms_euro_flange_distribution.eps}\label{fig:msharp:flange:c}} &
	\subfloat[TwoCubes: Triangle normal differences]{\includegraphics[width=0.45\linewidth]{images/ms_euro_twoCube_distribution.eps}\label{fig:msharp:tc:c}} 
%\\
%	\subfloat[Notch in MergeSharp Flange isosurface]{\includegraphics[width=0.3\linewidth]{images/mergeSharpvsShrec2.eps}\label{fig:msharp:b}} &
%	\subfloat[Dimpled MergeSharp isosurface (left) and smooth SHREC isosurface (right)]{\includegraphics[width=0.3\linewidth]{images/cone_mergesharp.eps}\label{fig:msharp:c}}
\end{tabular}
	\caption{Results of  MergeSharp on 39 Flange and 34 TwoCubes datasets
(exact gradients).
	\protect\subref{fig:msharp:flange:A}~Oriented angle distance to polygonal Flange meshes.
	\protect\subref{fig:msharp:flange:D}~Degree errors in 1-skeleton 
of sharp edges of Flange datasets.
	\protect\subref{fig:msharp:tc:A}~Oriented angle distance to polygonal TwoCubes meshes.
	\protect\subref{fig:msharp:tc:D}~Degree errors in 1-skeleton 
of sharp edges of TwoCubes datasets.
	\protect\subref{fig:msharp:tc:c}~Number of triangles 
with angle difference to polygonal Flange mesh above 30, 40 and 50 degrees.
(No Flange isosurface triangles have angle difference above $50^\circ$.)
	\protect\subref{fig:msharp:flange:c}~Number of triangles 
with angle difference to polygonal TwoCubes mesh above 30, 40 and 50 degrees.
}
\label{fig:msharp}
\end{figure*}	

\begin{figure*}[t]
\centering
\begin{tabular}{cc}
\subfloat[Notch in MergeSharp Flange isosurface]{\includegraphics[width=0.4\linewidth]{images/mergeSharpvsShrec2.eps}\label{fig:msharp:b}} \quad &
\quad
\subfloat[Dimpled MergeSharp isosurface (left) and smooth SHREC isosurface (right)]{\includegraphics[width=0.4\linewidth]{images/cone_mergesharp.eps}\label{fig:msharp:c}}
\end{tabular}

\caption{
\protect\subref{fig:msharp:b}~Notch in a MergeSharp Flange isosurface.
\protect\subref{fig:msharp:c}~Dimples in a MergeSharp Cone isosurface (left).
Compare with smooth SHREC isosurface (right).}

\end{figure*}


\section{Comparison with Other Algorithms}
\label{section:comparison}

We compared SHREC with software implementations of four other algorithms:
MergeSharp~\cite{bw-cisec-13,bw-erm-13}, 
PolyMender~\cite{j-rrpm-04}, 
EMC (Extended Marching Cubes)~\cite{kbsh-fssev-01} 
and SingularCocone~\cite{Dey2012}.
Table~\ref{table:software} contains descriptions of the software.

Input to both SHREC and MergeSharp is a regular grid sampling
of a scalar field and the gradients at the grid vertices.
Input to the software implementations of the other algorithms
is very different from input to SHREC or inputs to each other,
so one should be extremely careful in make comparisons
between these algorithms based on the results presented here.
For instance, on average,
EMC has fewer degree errors
than PolyMender or SingularCocone,
but EMC computes scalar, 
distance and normal values from formulas hard coded into the software.
PolyMender and SingularCocone (and SHREC and MergeSharp)
would certainly do much better if their input came
from formulas hard coded into their software.

SingularCocone has the most degree errors,
but SingularCocone is designed for reconstruction 
from point samples of a (possibly non-manifold) surface,
not for reconstruction from sampling of a scalar field.
Input to SingularCocone is point samples of a surface,
not scalar grid or gradient information.


\begin{figure*}[t]
	\centering
			\subfloat[PolyMender Flange isosurface]{\includegraphics[width=0.33\linewidth]{images/polymender4.eps}\label{fig:polymenderB:b}}\quad
			\subfloat[SHREC Flange isosurface]{\includegraphics[width=0.33\linewidth]{images/polymender3.eps}\label{fig:polymenderB:a}}
			\subfloat[Triangle normal differences]{\includegraphics[width=0.3\linewidth]{images/polymenderHistogram_1.eps}\label{fig:polymenderB:c}}\\
			\subfloat[PolyMender]{\includegraphics[width=0.2\linewidth]{images/polymender_cone_merge_2.eps}\label{fig:polymender:cone:b}}\qquad
			\subfloat[SHREC]{\includegraphics[width=0.2\linewidth]{images/polymender_cone_merge_1.eps}\label{fig:polymender:cone:a}}\qquad
			\subfloat[Magnified Smooth Tip Cone isosurfaces]{\includegraphics[width=0.4\linewidth]{images/polymender_cone_merge_3.eps}\label{fig:polymender:cone:c}}

\caption{PolyMender and SHREC comparison.
Mesh edges with dihedral angle below $140^\circ$ are colored red.
\protect\subref{fig:polymenderB:b}~PolyMender Flange isosurface.
\protect\subref{fig:polymenderB:a}~Corresponding SHREC Flange isosurface.
\protect\subref{fig:polymenderB:c} Distribution of differences of triangle normals
between PolyMender isosurface and polygonal mesh (red)
and between SHREC isosurface and polygonal mesh (green).
\protect\subref{fig:polymender:cone:b} PolyMender Cone isosurface.
\protect\subref{fig:polymender:cone:a} Corresponding SHREC Cone isosurface.
\protect\subref{fig:polymender:cone:c} Magnified view of Polymender isosurface (left)
and corresponding SHREC isosurface (right).
} 
\label{fig:polymenderB}
\end{figure*}


\paragraph{Comparison with MergeSharp.}

%mergesharp_euro =['E:\\Programs\\Win\\stdAlone\\ijk\\bin\\mergesharpbin\\Release\\mergesharp.exe', '-position', 'gradNS', '-trimesh']
%def compare_with_euro(n, iso):

Input to MergeSharp is a regular grid sampling of a scalar field
and the gradients at the grid vertices.
We ran MergeSharp on the same 39 Flange and 34 TwoCubes synthetic datasets
that we applied to SHREC in Section~\ref{section:synthetic_tests}.
We used the exact gradients on MergeSharp, not the Religrad gradients.
Figures~\subref*{fig:msharp:flange:A} and~\subref*{fig:msharp:tc:c}
shows the oriented angle distance between the MergeSharp isosurfaces 
and the polygonal mesh isosurfaces.
Five of the MergeSharp TwoCubes isosurfaces have angle distance 
near $180^\circ$ indicating ``flipped'' triangles produced by folds
in the mesh.
Figures~\ref{fig:msharp:flange:c} and~\ref{fig:msharp:tc:c} 
present the number of triangles with angle difference greater
than $30$, $40$ and $50$ degrees 
in the MergeSharp Flange and TwoCubes isosurfaces.
24 out of 40 of the Flange isosurfaces and 18 out of 34 
of the TwoCubes isosurface have angle distance above $30^\circ$
indicating significant problems in the reconstruction of sharp features.

Figures~\subref*{fig:msharp:flange:D} and~\subref*{fig:msharp:tc:D}
gives the number of degree errors in the 1-skeleton's of the sharp edges.
8 out of 40 of the Flange isosurfaces and 15 out of 34 of the TwoCubes
isosurfaces have degree errors.
The maximum number of degree errors is eight.

Note that all the results in Figure~\ref{fig:msharp} are
for MergeSharp isosurfaces produced from EXACT gradients.
Thus, they should not be compared with the SHREC results
in Figure~\ref{fig:shrecResults} for Flange isosurfaces
produced using Religrad gradients.
The 40 SHREC Flange isosurfaces produced using exact gradients
all have angle distance under ???
compared with angle distances above $30^\circ$
for 24 of the corresponding MergeSharp isosurfaces.
None of the SHREC Flange isosurfaces produced using exact gradients
have degree errors
compared with 8 MergeSharp isosurfaces with 4 to 8 degree errors.

As shown in Figure~\ref{fig:shrecResults}(a),
the 40 SHREC TwoCubes isosurfaces produced using exact gradients
all have angle distance under $2^\circ$.
(Note the y-scale in Figure~\ref{fig:shrecResults}(a)
is from 0 to $10^\circ$.)
18 of the corresponding MergeSharp TwoCubes isosurfaces have
angle distance above $30^\circ$.
None of the SHREC TwoCubes isosurfaces produced using exact gradients
have degree errors
compared with 15 of the TwoCubes isosurfaces with 2 to 5 degree errors.

Figure~\protect\subref*{fig:msharp:b} shows ``notches''
in a MergeSharp Flange isosurface.
Figure~\protect\subref*{fig:msharp:c} shows gentle dimples
in a MergeSharp Cone isosurface (left image).
The corresponding SHREC isosurface is smooth and does not have these dimples.

\begin{figure*}[p]
	\centering
		\subfloat[Flange: Oriented angle distance]{\includegraphics[ width=0.45\linewidth]{images/flange_polymender_max_angle.eps}\label{fig:polymender:d}}
				\subfloat[Flange: Degree errors]{\includegraphics[ width=0.45\linewidth]{images/flange_polymender_cd.eps}\label{fig:polymender:c}}\\
		\subfloat[TwoCubes: Oriented angle distance]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/twoCube_summary_1.eps}\label{fig:polymender:b}}\quad
		\subfloat[TwoCubes: Degree errors]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/twoCube_summary_2.eps}\label{fig:polymender:a}}\\
		\subfloat[Flange: Triangle normal differences]{\includegraphics[ width=0.49\linewidth]{images/flange_polymender_angle_dist.eps}\label{fig:polymender:e}}
\quad
			\subfloat[TwoCubes: Triangle normal differences]{\includegraphics[ width=0.49\linewidth]{images/twocube-35-polymender.eps}\label{fig:polymender:f}}
\\
\caption{Results of PolyMender on 40 Flange and 34 TwoCubes datasets.
\protect\subref{fig:polymender:d}~Oriented angle distance to polygonal Flange meshes.
\protect\subref{fig:polymender:c}~Degree errors in 1-skeleton of sharp edges of Flange datasets.
\protect\subref{fig:polymender:b}~Oriented angle distance to polygonal TwoCubes meshes.
\protect\subref{fig:polymender:a}~Degree errors in 1-skeleton of sharp edges of TwoCubes datasets.
(Note: Y-scale is 0 to 200 compared with y-scale 0 to 450 in (b).)
\protect\subref{fig:polymender:e}~Number of triangles with oriented angle difference to Flange mesh 
above $30$, $40$ and $50$ degrees.
\protect\subref{fig:polymender:f}~Number of triangles with oriented angle difference to TwoCubes mesh
above $30$, $40$ and $50$ degrees.
(Note: Y-scale is 0 to 200 compared with y-scale 0 to 400 in (e).)
}
\label{fig:polymenderA}
\end{figure*}

\begin{figure*}
	\centering
	\subfloat[Oriented angle distance]{\includegraphics[height=0.2\linewidth]{images/max_angle_isoex_2.eps}\label{fig:isoEx_summ:b}}
	\subfloat[Triangle normal differences]{\includegraphics[height=0.2\linewidth]{images/isoex_surf_angle_dist.eps}\label{fig:isoEx_summ:c}}
	\subfloat[Degree errors]{\includegraphics[height=0.2\linewidth]{images/countDegree_isoex_2.eps}\label{fig:isoEx_summ:a}}\\
	\subfloat[EMCpoly Flange isosurface]{\includegraphics[width=0.5\linewidth]{images/isoExFlange.eps}\label{fig:isoEx:a}}
	\subfloat[EMCpoly TwoCubes isosurface]{\includegraphics[width=0.5\linewidth]{images/isoExTwoCube.eps}\label{fig:isoEx:b}}\\
\caption{EMCpoly (Extended Marching Cubes) and SHREC comparison.
Tests tw1-tw4 are four TwoCubes scalar fields.
Tests fl1-fl4 are four Flange scalar fields.
\protect\subref{fig:isoEx_summ:b}~Oriented angle distances for EMCpoly (blue)
and SHREC (red).
\protect\subref{fig:isoEx_summ:c}~Number of triangles in EMCpoly isosurfaces
with oriented angle difference to polygonal mesh 
above $30$, $40$ and $50$ degrees.
\protect\subref{fig:isoEx_summ:a}~Degree errors 
in 1-skeleton of EMCpoly isosurface (blue).
(SHREC has no degree errors for these cases.)
\protect\subref{fig:isoEx:a} EMCpoly Flange isosurface.
The magnified region shows very thin mesh triangles aligned
with a 1-dimensional feature.
\protect\subref{fig:isoEx:b} EMCpoly TwoCubes isosurface.
The magnified region shows errors folds and degenerate triangles
in the EMCpoly isosurface mesh.}	
\end{figure*}


\paragraph{Comparison with PolyMender.}

PolyMender is an implementation of mesh repairing algorithm from Ju~\cite{j-rrpm-04}.
Input to PolyMender is a set of triangles representing a surface,
but not necessarily properly connected in a polygonal mesh.
PolyMender uses the triangles to build a regular scalar grid
representing the signed distance to the surface.
It also uses the triangles to determine surface normals
on the surface.
It extracts an isosurface mesh using the dual contouring algorithm 
described in~\cite{jlsw-dchd-02,sw-dcss-02}.
The extracted isosurface mesh is the ``mended'' polygonal mesh.

Because PolyMender contains an implementation of the dual contouring algorithm
from~\cite{jlsw-dchd-02,sw-dcss-02},
we used it to compare SHREC and the algorithm from~\cite{jlsw-dchd-02,sw-dcss-02}.
Our inputs to PolyMender were the polygonal meshes
(Figure~\ref{fig:mesh})
designed specifically for each surface to accurately represent the 0-dimensional
and 1-dimensional features on the surface.

PolyMender builds a multiresolution isosurface
using an octree instead of a fixed regular grid.
The highest resolution is determined by the depth of the octree.
For all tests, we ran PolyMender with octree depth set of 7.
At the highest resolution,
this octree sampled data from a regular grid with dimensions $\gDim{2^7}$ or $\gDim{128}$.
We set the scale set to 0.9 and used defaults for all other parameters.

Because PolyMender computes its scalar field and surface normals
from an input polygonal mesh,
we did not think it fair to compare PolyMender to SHREC with exact gradients.
Instead, we compared PolyMender to SHREC using Religrad gradients.
Since PolyMender surface normals come from triangles on the polygonal meshes
used for the angle distance measurements,
while Religrad gradients are computed from the scalar data,
we think this comparison is actually biased in favor of PolyMender.

Figures~\protect\subref*{fig:polymenderB:b} 
and~\protect\subref*{fig:polymenderB:a} 
show part of a Flange isosurface reconstructed by PolyMender
and a corresponding isosurface produced by SHREC (Religrad gradients).
Note the flipped triangles and distorted ``sharp'' curve (red) in the PolyMender isosurface.
Figure~\protect\subref*{fig:polymenderB:c} shows the distribution of differences 
of triangle normals between the PolyMender isosurface and the polygonal mesh
and between the SHREC isosurface and the polygonal mesh.
All SHREC triangle normals are within $25^\circ$ of the polygonal mesh normals,
while PolyMender has numerous triangles with normals greater than $30^\circ$
of the polygonal mesh normals.

Figures~\subref*{fig:polymender:cone:b}, \subref*{fig:polymender:cone:a}
and~\subref*{fig:polymender:cone:c}
show a PolyMender Smooth Tip Cone isosurface and 
the corresponding SHREC isosurface (Religrad gradients).
The 1-dimensional feature around the base of the cone has a $60^\circ$ dihedral angle.
In the PolyMender isosurface,
there are numerous ``notches'' along the 1-dimensional feature.

We ran PolyMender on the same 40 Flange and 34 TwoCubes meshes
that we applied to SHREC in Section~\ref{section:synthetic_tests}.
Figure~\ref{fig:polymenderA} shows the oriented angle distances from the polygonal meshes
and the degree errors in the 1-skeletons of sharp edges.
Most of the PolyMender Flange and TwoCubes isosurfaces had an oriented angle distance greater than $90^\circ$
from the corresponding polygonal mesh normals.
24 out of 40 of the PolyMender Flange isosurfaces had over 150 triangles
whose normals were more than $50^\circ$ from the normals of the corresponding polygonal meshes.
In comparison, only one SHREC Flange isosurface (Religrad gradients) had triangles
whose normals were more than $50^\circ$ from the normals of the corresponding polygonal meshes
(Figure~\ref{fig:shrecResults}).
No SHREC Flange isosurface (Religrad gradients) had more than 15 triangles
whose normals were more than $30^\circ$ from the normals of the corresponding polygonal meshes
Almost all of the PolyMender Flange isosurfaces had degree errors
and 25 out of 40 had over 200 degree errors.
Only 8 out of 40 SHREC Flange isosurfaces (Religrad gradients) had degree errors
and the maximum number of degree errors was eight.

PolyMender did a bit better on the TwoCubes isosurfaces,
probably because the 1-dimensional features in the TwoCubes level sets are line segments.
Only one of the 34 PolyMender TwoCubes isosurfaces had over 150 triangles
whose normals were more than $50^\circ$ from the normals of the corresponding polygonal meshes.
18 out of 34 PolyMender TwoCubes isosurfaces had over 50 triangles
whose normals were more than $50^\circ$ from the normals of the corresponding polygonal meshes.
Most of the PolyMender TwoCubes isosurfaces had degree errors,
but none had more than 180 degree errors.
8 out of 34 had more than 100 degree errors
and 22 out of 34 had more than 40 degree errors.
5 out of 34 SHREC TwoCubes isosurfaces (Religrad gradients)
had angle distance greater than $40^\circ$ to the corresponding polygonal meshes.
The same five SHREC isosurfaces had degree errors,
but no SHREC isosurface had more than four such errors.


\begin{figure*}[t]
	\centering
		\subfloat[Flange: Unoriented angle distances]{\includegraphics[width=0.3\linewidth]{images/flange_wc_max_angle.eps}\label{fig:cocone:flange:b}}	
		\subfloat[Flange: Degree errors]{\includegraphics[width=0.3\linewidth]{images/flange_wc_cd.eps}\label{fig:cocone:flange:a}}
		\subfloat[Flange: Triangle normal differences]{\includegraphics[width=0.3\linewidth]{images/cocone_angle_distri_flange.eps}\label{fig:cocone::c}}		

		\subfloat[TwoCubes: Unoriented angle distances]{\includegraphics[width=0.3\linewidth]{images/twocube_wc_max_angle.eps}\label{fig:cocone:b}}	
		\subfloat[TwoCubes: Degree errors]{\includegraphics[width=0.3\linewidth]{images/twocube_wc_cd.eps}\label{fig:cocone:a}}
		\subfloat[TwoCubes: Triangle normal differences]{\includegraphics[width=0.3\linewidth]{images/cocone_angle_distri_twoCube.eps}\label{fig:cocone:c}}		

		
\caption{Comparison of SHREC and SingularCocone on 10 Flange and 15 TwoCubes datasets.
Point clouds for SingularCocone (and FeatureRecon) were computed
by supersampling the polygonal meshes.
(a)~Unoriented angle distances from Singular Cocone (blue) Flange isosurfaces
and from SHREC Flange isosurfaces (exact gradients in red,
Religrad gradients in green) to polygonal Flange meshes.
(b)~Degree errors in the 1-skeleton of the sharp edges
for SingularCocone Flange isosurfaces (blue)
and SHREC isosurfaces (Religrad gradients, red).
(SHREC isosurfaces based on exact gradients have no degree errors.)
(c)~Number of SingularCocone triangles 
with normal difference to Flange mesh
above 30$^\circ$, 40$^\circ$ and 50$^\circ$.
(d)~Unoriented angle distances from Singular Cocone (red) TwoCubes isosurfaces
and from SHREC TwoCubes isosurfaces (Religrad gradients, green) 
to polygonal TwoCubes meshes.
(e)~Degree errors in the 1-skeleton of the sharp edges
for SingularCocone TwoCubes isosurfaces (red)
and SHREC isosurfaces based (Religrad gradients, blue).
(f)~Number of SingularCocone triangles 
with normal difference to TwoCubes mesh
above 30$^\circ$, 40$^\circ$ and 50$^\circ$.
}
\label{fig:cocone:compare}

\end{figure*}


\paragraph{Comparison with EMC (Extended Marching Cubes):}

EMC is a sample implementation by Mario Botsch
of the Extended Marching Cubes algorithm~\cite{kbsh-fssev-01}.
The program has a function which provides the scalar value of a point cloud dataset,
the directed distances along the $x$, $y$ and $z$ axes to some level set of the point cloud (a sphere),
and the gradients at query points near the level set.
Isosurfaces with sharp features are constructed by combining the functions
to represent the union, intersection or difference of balls 
defined by the point cloud datasets.

The union, intersection and difference of balls produces visually interesting surfaces
but such surfaces do not seem a realistic approximation to the surfaces found in industrial products.
To compare EMC with SHREC, we implemented functions which produce scalar values, directed distances,
and gradients, for Cube and Annulus scalar fields.
By combining these functions,
we the corresponding values for the TwoCubes and Flange scalar fields.
We added only functions to provide the relevant scalar field measurements,
but did not change the EMC code which generates the isosurface.
Our modification of EMC is called EMCpoly.

We ran EMCpoly on four Flange scalar fields 
with four randomly generated axes directions
and four TwoCubes scalar fields with four randomly generated orientations.
We ran SHREC on eight corresponding datasets representing 
the same scalar fields.
For both EMCpoly and SHREC,
the Flange scalar fields were sampled on a $\gDim{200}$ regular grid
and the TwoCubes scalar fields were sampled on a $\gDim{150}$ regular grid.

Figure~\protect\subref{fig:isoEx_summ:b} shows the angle distance
between the EMCpoly isosurfaces and the polygonal meshes
The oriented angle distance of the SHREC isosurfaces is less than 20$^\circ$,
but is over $90^\circ$ for all of the EMCpoly isosurfaces.
Figure~\protect\subref*{fig:isoEx_summ:c} shows the
number of triangles in EMCpoly isosurfaces 
whose normals differ more than $30$, $40$ or $50$ degrees
from the polygonal mesh normals.
All four of the EMCpoly Flange isosurfaces had over 20 triangles
with normals differing more than $50^\circ$ from the polygonal mesh.
The four EMC TwoCubes isosurfaces were better,
with only a few triangles with normals differing more than $50^\circ$.

Figure~\protect\subref*{fig:isoEx_summ:a} shows the degree errors
in the 1-skeletons of the \mbox{EMCpoly} isosurfaces.
All eight EMCpoly isosurfaces had some degree errors,
but each of the TwoCubes isosurfaces had under 40 degree errors
while each of the Flange isosurfaces had over 200 errors.
None of the eight SHREC isosurfaces had any degree errors.
Examples of errors in EMCpoly Flange and TwoCubes isosurfaces
are shown in Figures~\subref*{fig:isoEx:a} 
and~\subref*{fig:isoEx:b}.

Visually, the sharp features in the EMCpoly isosurface look quite good.
The large number of triangles with normals very different from the polygonal
mesh normals and the high number of degree errors
are probably caused by the large number of near degenerate triangles.
Each of the EMCpoly TwoCubes isosurfaces has over 250 triangles
(out of 46K-48K)
with angle less than $1^\circ$.
Each of the EMCpoly Flange isosurfaces has over 1500 triangles
(out of 200K)
with angle less than $1^\circ$.
In contrast, none of the eight corresponding SHREC isosurfaces
had any triangles with angles less than $4^\circ$.
The SHREC TwoCubes and Flange isosurfaces had about 40K triangles,
and $150K$ triangles, respectively.

Small perturbations in the locations of vertices 
of thin triangles
create almost arbitrary normal orientations
contributing to the normal differences and degree errors
in the EMCpoly isosurfaces.
These thin triangles are aligned with the 1-dimensional features
so they do not create large visual anomalies in the EMCpoly isosurfaces.

As previously noted, EMCpoly uses hard coded functions
to directly compute scalar values,
directed distances and gradient information.
Thus, the vertex locations both on and near the sharp features
are extremely precise.
If EMCpoly computed such information from an input mesh as does PolyMender
or from scalar and gradient data, as does SHREC,
those vertex positions would be much less precise.
We conjecture that under those circumstances,
the numerous thin triangles would be much more visible,
creating numerous visual anomalies.


\begin{figure}[t] 
	%dataset t110 reconstructed from perfect mesh 
	\centering 
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/compare_cocone_perfect_mc_a.eps}\label{fig:cocone_img:a}}
		\subfloat[]{\includegraphics[width=0.5\linewidth]{images/compare_cocone_perfect_mc_b.eps}\label{fig:cocone_img:b}}

\caption{SingularCocone TwoCubes isosurface. 
\protect\subref{fig:cocone_img:a}~Input cloud is a supersampled polygonal mesh. 
\protect\subref{fig:cocone_img:b}~Input cloud is a supersampled
set of isosurface vertices produced by Marching Cubes.
The magnified regions show some of the errors. 
The reconstruction from Marching Cube vertices is worse 
than the reconstruction from the supersampled polygonal mesh.. }
	\label{fig:cocone_compare_from_perfect_1}
	\vskip-0.2cm
\end{figure} 



\paragraph{Comparison with SingularCocone.}

Extensive research has been done on reconstruction of surfaces
with sharp features from point cloud data.
Regular grid scalar data can easily be converted to point cloud data
by approximating the intersection points 
between a given level set and the grid edges,
and applying a point cloud reconstruction algorithm to the intersection points.
Perhaps, this is an effective way to reconstruct isosurfaces 
with sharp features?

To test the efficacy of point cloud reconstruction
for isosurface reconstruction,
we tested one algorithm, SingularCocone,
on reconstructing the TwoCubes isosurfaces.
Cube merging in MergeSharp and SHREC plays a similar role
to the ``protective balls'' in SingularCocone,
so we thought that SingularCocone would perform
better than other point cloud reconstruction algorithms.

We note that we are only evaluating whether SingularCocone
is more effective than SHREC in reconstructing isosurfaces.
SingularCocone is really built for point cloud data
which is much noisier and more difficult to handle
than scalar data.
SingularCocone also can reconstruct non-manifold surfaces
and their non-manifold features.
SHREC has no application to reconstruction from point cloud data
or to reconstruction of non-manifold surfaces.

As described in Section~\ref{section:related},
SingularCocone extracts a surface mesh from a weighted Delaunay triangulation
of a set of sample points of the features and the smooth portions
of the mesh.
SingularCocone requires two inputs: 
a point cloud and a weighted sampling
of the 0 and 1 dimensional features of the surface.
Weight of the sampling determines the size of ``protecting balls''
around surface features.
SingularCocone outputs a feature sensitive mesh.

In order to run SingularCocone,
we must construct a weighted sampling of surface features
from a set of points sampling the surface.
We use the algorithm FeatureRecon by Dey et al.~\cite{Dey2013}
to compute sample points on the surface features.


\begin{table*}[t]
\centering
\begin{tabular}{|l||c|c|c|r|r|r|r|}
\hline
              & & & \centercol{Avg Num} 
                                     & \centercol{Avg Num} 
                                         & \centercol{Avg Num} & & \\
Dataset      & Grid Size & Spacing & Isovalue 
                                 & \centercol{Active Cubes} 
                                    & \centercol{Iso Vert} 
                                        & \centercol{Iso Tri} 
                                             & \centercol{Time} \\
\hline
\hline

%setA.nhdr
%1599600 grid cubes.
%Isovalue 22000.  26049 isosurface vertices.  51170 isosurface simplices.
%25584 (1%) non-empty cubes.
%Wrote output to file: setA.isov=22000.off

Motorcycle Engine & $200 \times 129 \times 62$
   & $0.27 \times 0.27 \times 0.68$ (mm)
   & 22000 & 25k& 26k& 51k& 1.9 sec \\
\hline

%160uCT.crop1
%10578000 grid cubes.
%Isovalue 4000.  527574 isosurface vertices.  1039534 isosurface simplices.
%519308 (4%) non-empty cubes.
%Wrote output to file: 160uCT.crop1.aniso.isov=4000.off

Volt & $411 \times 431 \times 61$ & $1 \times 1 \times 1$ 
     & 4000 & 519k& 527k& 1039k& 39 sec \\
\hline

%%% CMM.setA.nhdr in folder industrial CT
%48555195 grid cubes.
%Isovalue 20000.  863987 isosurface vertices.  1726046 isosurface simplices.
%861673 (1%) non-empty cubes.

CMM & $500 \times 500 \times 196$ & $0.2 \times 0.2 \times 0.31$ (mm)
   & 20000& 861k& 863k& 1726k& 60 sec \\
\hline
\end{tabular}

\caption{CT dataset sizes, isovalues, and average statistics
on isosurfaces produced by SHREC.
Average number of active cubes, 
average number of isosurface vertices,
average number of isosurface triangles,
and average SHREC running time.
All isosurface quadrilaterals are triangulated
before counting the number of isosurface triangles.
}

\label{table:CTdatasets}

\end{table*}


\paragraph{Experimental details:} 

The input to FeatureRecon is a point cloud. 
We tested two different input point cloud;
\begin{enumerate}
\item We applied Marching Cubes~\cite{lc-mchr3-87} 
to fifteen TwoCubes datasets. 
We supersampled the vertices of the Marching Cubes mesh
using the Monte Carlo point sampling,
to generate a point cloud with approximately sixty-five thousand points.

\item We supersampled the polygonal meshes described 
in Section~\ref{section:measure}
to generate a point cloud with approximately sixty-five thousand points.
\end{enumerate}

The first experiment measured how well FeatureRecon and SingularCocone
could reconstruct an isosurface from scalar data.
The second experiment measured how well FeatureRecon and SingularCocone
reconstructed surface meshes from point cloud samplings of those meshes.

The two different point clouds are used as input to FeatureRecon to
extract sample points on the surface features.  
The feature sample points generated by FeatureRecon along with the
supersampled point cloud are used as input to SingularCocone.

FeatureRecon has nine separate
parameters. Experimentally and also noted by the authors Dey et
al.~\cite{Dey2013}, we found FeatureRecon to be heavily reliant on
parameter fine tuning. We used the following parameter values for the
TwoCubes datasets, (as suggest by the authors Dey et
al.~\cite{Dey2013}).  $-t = 25,-fl = 0.04, -cl = 0.06, -dc = 0, -\rho3
= 0.32, -\rho1 = 0.0, -rc = 3$.

Figure~\ref{fig:cocone_compare_from_perfect_1} shows 
a TwoCubes mesh reconstructed by SingularCocone.
The associated ``sharp" edges are
also shown. Figure~\ref{fig:cocone_compare_from_perfect_1}(a) shows
the reconstruction from the point cloud generated from the polygonal
mesh. The red ``sharp" edges show that the
reconstruction has many errors. The magnified regions show some of the
errors along the sharp edges and
corners. Figure~\ref{fig:cocone_compare_from_perfect_1}(b) shows the
reconstruction from the point cloud generated from running Marching
Cubes. The magnified regions show the same regions as
Figure~\ref{fig:cocone_compare_from_perfect_1}(a). The reconstruction
is worse than SingularCocone reconstruction 
from the supersampled polygonal mesh.

Figure~\ref{fig:cocone:compare} shows a comparison
of SingularCocone and SHREC on 15 different datasets. 
The inputs to SingularCocone for these tests were generated 
from polygonal meshes. 
The results from Marching Cubes input are worse and not shown.
Because SingularCocone does not assume the output is a manifold,
the triangles in the SingularCocone mesh have arbitrary orientations.
Thus, we use the unoriented angle distance
to compare the SingularCocone and SHREC meshes.


\begin{figure}[t]
	\centering
	\subfloat[Single image slice, original machine part]{\includegraphics[width=0.5\linewidth ]{images/cly_sleeve.1.eps}\label{fig:setA.crop1.1}}
	\subfloat[Sharp Isosurface]{\includegraphics[width=0.5\linewidth]
		{images/setA.rendering.eps}\label{fig:setA.crop1.2}}
	\caption{Motorcycle Engine dataset.~\protect\subref{fig:setA.crop1.1} a slice of the original CT image, note the streaking artifacts introduced during the scanning process.
		The inset shows the original machine part. Figure \protect\subref{fig:setA.crop1.2} shows the sharp mesh.}
	\label{fig:ict:engineA}
\end{figure}


\begin{figure}[t]
\centering
	\includegraphics[width=\linewidth]{images/ictsetA_3.eps}
	\caption{SHREC with Religrad gradients computed from part of industrial CT data (Motorcycle Engine). Magnified regions show ``sharp" edges reconstructed. In red, picture from the original item.} \label{fig:ict:engineB}
\end{figure}


We ran SingularCocone and SHREC on the same 15 datasets,
and used both exact and Religrad gradients for SHREC.
Figure~\protect\subref*{fig:cocone:b} shows the unoriented angle distance
between the SingularCocone isosurfaces and the corresponding polygonal meshes,
and the SHREC isosurfaces based on Religrad gradients
and the corresponding polygonal meshes.
The maximum angle distance was $43^\circ$ for SHREC
with the mean error of 8$^\circ$ for the 15 tests. 
In comparison, the maximum angle distance was 87$^\circ$ for SingularCocone,
with a mean of 79$^\circ$.  
Figure~\protect\subref*{fig:cocone:c}
shows the number of SingularCocone triangles 
with normal difference greater than $30$, $40$ or $50$ degrees
to the corresponding polygonal mesh normals.
On all the test cases there are large numbers of triangles
with angle differences more than 40$^\circ$ and 50$^\circ$.

Figure~\protect\subref*{fig:cocone:a} shows the degree errors
for SingularCocone isosurfaces
and SHREC isosurfaces based on Religrad gradients.
SHREC with Religrad gradients generates degree errors in only two isosurfaces
(t6 and t13) and does not generate more than 4 degree errors per isosurface.
SHREC with exact gradients generates no degree errors.
In contrast, SingularCocone generates an average of 330 degree errors
in each isosurface.


\begin{figure}[t]
\centering
	\includegraphics[width=\linewidth]{images/volt.eps}
	\caption{SHREC with Religrad gradients computed from part of the VOLT data. Magnified regions show ``sharp" reconstructed edges. In red picture of the original item.}
	\label{fig:ict:volt}
\end{figure}

\begin{figure}[t]
	\centering
	\subfloat[]{\includegraphics[width=\linewidth]{images/cmm.eps}\label{fig:ict:CMM:a}}\\
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/CMM.singleSliceXY.eps}\label{fig:ict:CMM:b}}
	\caption{(a) SHREC with Religrad gradients computed from part of the CMM dataset. Magnified regions show ``sharp" reconstructed edges. (b) Single slice of the CT scan, with scalar values mapped to the ``heat" color map.}\label{fig:ict:CMM}
\end{figure}

\section{Experimental Results on CT Data}

We applied the SHREC algorithm on industrial X-ray computed tomography (CT)
scans of three objects.
The Motorcycle Engine dataset is an industrial CT scan 
of a motorcycle engine cylinder.
(See photo in Figure~\ref{fig:ict:engineA}(a).)
The Volt dataset is an industrial CT scan 
of a 440 voltage electrical connector.
is an industrial CT scan of a solid aluminum shape
used to calibrate measurements from CT scans.
CMM stands for ``coordinate measuring machine''.
Since the CT scanner provides only scalar values for each object,
we used Religrad to construct gradients at the grid vertices.

Dataset sizes, spacing, isovalues and average isosurface sizes are presented
in Table~\ref{table:CTdatasets}.
The full Motorcycle Engine dataset has very large dimensions
so we only report on a small $200 \times 129 \times 62$ corner 
of that dataset depicted in Figures~\ref{fig:ict:engineA} 
and~\ref{fig:ict:engineB}.
Note the non-uniform spacing in the Motorcycle Engine and CMM datasets.

Figures~\ref{fig:ict:engineA} and~\ref{fig:ict:engineB} 
show a small corner of the motorcycle engine cylinders
and the results of reconstruction of that corner.
The magnified regions (with black border) in Figure~\ref{fig:ict:engineB}
show that the sharp edges are well reconstructed. 
In yellow border boxes, we see magnified parts
of the reconstructed mesh along with the sharp and non-sharp edges
generated by SHREC.

Figure~\ref{fig:ict:volt} shows part of the 440 voltage connector (in red)
and the SHREC reconstruction of the Volt dataset.
To aid in visualization of the sharp features,
the figure displays a cropped image of the the reconstructed isosurface.
Once again we see that SHREC is able to reconstruct 
the sharp (flange-like) curves accurately.

Figure~\ref{fig:ict:CMM} shows the SHREC reconstruction of the CMM dataset.
Again, the reconstructed isosurface is cropped to better
display the sharp features.
Figure~\protect\subref*{fig:ict:CMM:b} shows a single slice of
the CT scan, with scalar values mapped to the ``heat" color map.

SHREC does a good job of reproducing the 0 and 1 dimensional features
from each of these data sets
and in producing meshes which accurately reflect those features.


\section{Timings}
\begin{table}[h]
	\centering
	\begin{tabular}{|l|c|c|}\hline
             & Num & \\ 
		Software & Iso Tri & Time \\ \hline
		Marching Cubes & 41K & 0.4  sec \\ 
		EMCpoly & 46K & 0.8 sec \\
		Polymender & 85K & 0.7 sec \\
		MergeSharp & 35K & 0.6 sec \\
		SHREC grad3 & 34K & 1.0 sec \\
		SHREC grad9 & 34K &  1.4 sec \\
		Religrad & 34K & 30 sec \\
		SingularCocone & 125K & 1.8 sec  \\
		FeatureRecon & 125K & 344 sec  \\
\hline
	\end{tabular}
\caption{Timings.}

\label{table:timings}

\end{table}

Table~\ref{table:timings} gives the running time
of the various algorithms on a TwoCubes dataset.
The running time was measured on a Windows PC 
with an Intel Core i7-4770 processor (3.4 GHz) and 16 GB RAM.

Inputs to Marching Cubes, EMCpoly, 
MergeSharp and SHREC were grids of size $\gDim{150}$.  
Polymender constructed an oct tree with depth 7,
with a full resolution grid of size $\gDim{128}$.
Inputs to SingularCocone and FeatureRecon had 60K sample points.

The point cloud reconstruction software
SingularCocone and FeatureRecon are very different
from the isosurface reconstruction software,
so one should be extremely careful in comparing its timings
to the others.
SingularCocone receives a set of points on 0 and 1-dimensional features
as part of its input,
while EMCpoly, PolyMender, MergeSharp and SHREC must spend
time computing such points from gradients or surface normals.
On the other hand,
FeatureRecon receives a set of sample points 
without any gradient or surface normal information,
while EMCpoly, PolyMender, MergeSharp and SHREC receive
gradient or surface normals as part of their input.
Computing points on 0 and 1-dimensional features
is much easier if gradient or surface normals are provided.

EMCpoly, Polymender, MergeSharp and SHREC take comparable times.
SHREC takes the longest and the time increases 
if gradients are selected from larger subgrids around each cube.
The extra time taken by SHREC is spent selecting gradients
around each cube.
The time for merging cubes in MergeSharp and SHREC is
a small part of the total, since merging is only performed
around selected grid cubes covering sharp features.

If a gradient grid file is not available,
then it must be constructed from the scalar grid.
The Religrad time (30 second) to construct the gradient grid
should be added to the SHREC time.
Note that EMCpoly, Polymender and MergeSharp would also require
Religrad or some similar program to construct a gradient grid
or set of surface normals,
so the programs still take comparable times.
FeatureRecon takes considerably longer than Religrad
but input to FeatureRecon is  set of surface sample points,
not a scalar grid.


\section{Software}

Software used in this paper can be downloaded from:\\
\href{http://web.cse.ohio-state.edu/research/graphics/isotable}{web.cse.ohio-state.edu/research/graphics/isotable}.

In particular, the web site contains source code
for SHREC, Religrad, MergeSharp and EMCpoly.
The web site also contains programs 
to generate regular grid samplings of scalar and gradient fields
(ijkgenscalar),
generate polygonal meshes of annuli, flanges, two cubes,
cones, frustra, smooth tip cones and cannons (ijkgenmesh),
compute angle distances (angle\_dist),
find sharp edges (findsharp) 
and count the vertex degree in the graph formed by the sharp edges
(countdegree).

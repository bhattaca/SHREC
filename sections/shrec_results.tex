
\begin{figure*}
\centering
\begin{tabular}{ccc}
\includegraphics[width=1.5in]{images/twocubes.eps} \qquad &
\qquad
\includegraphics[width=1.5in]{images/annulus.eps}
\qquad &
\includegraphics[width=1.5in]{images/flange.eps} \\

(a) Two cubes. & (b) Annulus. & (c) Flange. \\
\\
\includegraphics[width=1.2in]{images/frustrum.eps} \qquad &
\qquad
\includegraphics[width=1.2in]{images/smooth_tip_cone.eps} 
\qquad &
\qquad
\includegraphics[width=1.2in]{images/cannon_iso.eps} \\
(d) Frustrum. & (e) Smooth tip cone. & (f) Cannon.
\end{tabular}
\caption{Isosurfaces constructed from synthetic test data sets.}
\label{fig:synthetic_data}
\end{figure*}

\newcommand{\fCYL}   {\emath{f^{Cyl}}}
\newcommand{\fCII}   {\emath{f^{Cyl \times 2}}}
\newcommand{\fPL}    {\emath{f^{Pl}}}
\newcommand{\fPLII}  {\emath{f^{Pl \times 2}}}
\newcommand{\fANN}   {\emath{f^{Ann}}}
\newcommand{\fCN}    {\emath{f^{Cone}}}
\newcommand{\fSCN}   {\emath{f^{SCone}}}
\newcommand{\fTCN}   {\emath{f^{TCone}}}
\newcommand{\fFR}    {\emath{f^{Fr}}}
\newcommand{\fX}     {\emath{f^{X}}}
\newcommand{\fCAN}   {\emath{f^{Can}}}
\newcommand{\NneqII} {\emath{N_{\neq 2}}}


\section{Experimental Results on Synthetic Data}\label{sec:synData}
\label{section:results}

\subsection{Synthetic Scalar and Gradient Data}
\label{section:synthetic}

To measure the quality of our reconstruction,
we used a number of synthetic scalar and gradient data sets.
(See Figure~\ref{fig:synthetic_data}.)
Given a point $p$,
let $f^{L_1}_{p}(q)$ be the $L_1$ distance from $p$ to $q$.
A {\em Cube} data set is generated by sampling $f^{L_1}_p$
and its gradients on vertices of the regular grid.

Level sets of $f^{L_1}_p$ are cubes whose edges are
parallel to the coordinate axes
and whose facets are orthogonal to those axes.
By rotating $f^{L_1}_p$ around $p$, 
we can generate a scalar field whose level sets are cubes
that are not axis-aligned.
By taking the minimum of two (rotated) scalar fields, 
$f^{L_1}_p$ and $f^{L_1}_{p'}$, 
centered around two different points, $p$ and $p$', respectively,
we get a scalar field whose level sets are the boundaries
of the unions of the two cubes.
(See Figure~\ref{fig:synthetic_data}(a).)
We call a regular grid sampling of such a scalar field
and its gradients a {\em TwoCubes} data set.
The isosurface of a TwoCubes data set has twenty 0-dimensional features,
fourteen of which are cube corners and six of which are ``saddle points''
where the two boundaries of two cubes meet.
We use the TwoCubes data sets with various rotations
as test sets for the reconstruction of 0-dimensional features.

Let $\ell$ be a line.
Let $\fCYL_{\ell}(q)$ be the Euclidean distance from point $q$ to $\ell$.
The level sets of $\fCYL_{\ell}(q)$ are infinite cylinders around $\ell$.
Let $\fCII_{\ell,r}(q)$ equal $|\fCYL_{\ell}(q) - r|$.
The level sets of $\fCII_{\ell,r}(q)$  are pairs of infinite cylinders
at equal distances from the cylinder of radius $r$ around $\ell$.
Let $\fPLII_{p,\ell}(q)$ be the (unsigned) distance from $q$ to the plane
that contains point $p$ and is orthogonal to line $\ell$.
Let $\fANN_{p,\ell,r}(q)$ be the maximum 
of $\fCII_{\ell,r}(q)$ and of $\fPLII_{p,\ell}(q)$.
The level sets are the boundaries of thickened annuli.
(See Figure~\ref{fig:synthetic_data}(b).)

The width of the thickened annuli defined by $\fANN_{p,\ell,r}$
equals their height.
We can adjust change the difference between the width and height
by adding constants to $\fCII_{\ell,r}$ or $\fPLII_{p,\ell}(q)$.
Let $\fANN_{p,\ell,r,c_1,c_2}(q)$ be the maximum 
of $\fCII_{\ell,r}(q)+c_1$ and of $\fPLII_{p,\ell}(q)+c_2$.
If $c_1$ is greater than $c_2$, 
then the height is $c_1-c_2$ units greater than the width.
If $c_2$ is greater than $c_1$, 
then the width is $c_2-c_1$ units greater than the height.

Define $\fFR_{p,\ell,r,c}(q)$ as the minimum
of $\fANN_{p,\ell,r,c,0}(q)$ and $\fANN_{p,\ell,r,0,c}(q)$.
The level sets of $\fFR_{p,\ell,r,c}(q)$ are the boundaries
of the unions of two thickened annuli.
(See Figure~\ref{fig:synthetic_data}(c).)
One annuli has height $c$ units greater than its width
while the other has width $c$ units greater than its height.
A {\em Flange} data set is a regular grid sampling of $\fFR_{p,\ell,r,c}(q)$
and its gradients.
The Flange data set has no 0-dimensional features.
We use the Flange data sets as test sets
for the reconstruction of 1-dimensional features.

We use two other types of data sets to test our algorithm on dihedral
angles other than $90^\circ$.
A cone is defined by an apex $p$, an axis direction $\zeta$,
and an angle $\alpha < 90^\circ$.
The cone is the union of all the rays from $p$ forming angle $\alpha$
with $\zeta$.
Let $\ell$ be the directed line through $p$ with direction $\zeta$,
i.e. the cone axis.
Let $\pi_{\ell}(q)$ be the projection of point $q$ on $\ell$.
Let $D_1(q)$ be the distance from $p$ to $\pi_{\ell}(q)$
and let $D_2(q)$ be the signed distance from $\pi_{\ell}(q)$ to $p$.
(The distance is negative if $\pi_\ell(q)-p$ points in the opposite
direction from $\zeta$.)
Define $\fCN_{p,\zeta,\alpha}(q)$ 
as $\cos(\alpha) D_1(q) - \sin(\alpha) D_2(q)$.
Function $\fCN_{p,\zeta,\alpha}(q)$ is the signed distance
from point $q$ to its orthogonal projection on the cone,
when that orthogonal projection exists.
The level sets of $\fCN_{p,\zeta,\alpha}(q)$ are cones
with axis $\ell$.

We truncate the cone by defining a plane orthogonal to $\ell$.
Let $p'$ be a point on ray $p+t\zeta$
where $\zeta$ is a unit vector.
Let $\fPL_{p',\zeta}(q)$ equal $(q-p') \cdot \zeta$,
the (unsigned) distance from $q$ 
to the plane containing $p'$ orthogonal to $\zeta$.
Define
\begin{equation*}
\fFR_{p,\zeta,\alpha,p'}(q) = 
\max \left ( \fCN_{p,\zeta,\alpha}(q), \fPL_{p',\zeta}(q), \fPL_{p',-\zeta}(q)
\right ) .
\end{equation*}
The level sets of $\fFR_{p,\zeta,\alpha,p'}(q)$ are frustra.
(See Figure~\ref{fig:synthetic_data}(d).)

The level sets of $\fFR_{p,\zeta,\alpha,p'}(q)$
have two closed curves forming 1-dimensional features.
The dihedral angle on one of these curves is $90^\circ + \alpha$
while the dihedral angle on the other is $90^\circ - \alpha$.
To generate a field with dihedral angles of $90^\circ + \alpha$
or $90^\circ - \alpha$, but not both,
we modify $\fFR_{p,\zeta,\alpha,p'}(q)$ so that the level sets
are capped by spheres at one end.

Define
\begin{align*}
\fSCN_{p,\zeta,\alpha,p'}(q) & =
\left \{
\begin{array}{ll}
|q-p'| & \mbox{ if } \angle(q,p',p) \le 90^\circ - \alpha,\\
\fCN_{p,\zeta,\alpha}(q) & \mbox{ if } 
  \angle(q,p',p) > 90^\circ - \alpha,
\end{array}
\right .
\\
\fTCN_{p,\zeta,\alpha}(q) & = 
\max \left ( \fSCN_{p,\zeta,\alpha,p'}(q), \fPL_{p',\zeta} \right ).
\end{align*}

A level set of $\fSCN_{p,\zeta,\alpha,p'}(q)$ is a cone
with its tip smoothed.
A level set of $\fSCN_{p,\zeta,\alpha,p'}(q)$ is a truncated cone
with its tip smoothed.
The level set has a single closed curve forming a 1-dimensional feature
with dihedral angle $90^\circ - \alpha$.
The {\em Smooth Tip Cone} data set is a regular sampling
of $\fTCN_{p,\zeta,\alpha,p'}(q)$ and its gradients.
We use Smooth Tip Cone data sets to evaluate reconstruction
of dihedral angles less than $90^\circ$.

Let $p'$ and $p''$ be points on the ray $p + t \zeta$ where
$|p-p'|$ is less than $(1-\sin(\alpha)) |p-p''|$.
Define
\begin{align*}
\fX_{p,\zeta,\alpha,p''}(q) & =
\left \{
\begin{array}{ll}
|q-p''| & \mbox{ if } \angle(q,p',p) > 90^\circ - \alpha,\\
\fCN_{p,\zeta,\alpha}(q) & \mbox{ if } \angle(q,p',p) \le 90^\circ - \alpha.
\end{array}
\right .
\\
\fCAN_{p,\zeta,\alpha,p',p''}(q) & =
\max \left ( \fX_{p,\zeta,\alpha,p''}(q), \fPL_{p',-\zeta} \right ) .
\end{align*}

A level set of $\fCAN_{p,\zeta,\alpha,p'}(q)$ has the shape of a cannon.
The level set has a single closed curve forming a 1-dimensional feature
with dihedral angle $90^\circ + \alpha$.
The {\em Cannon} data set is a regular sampling
of $\fCAN_{p,\zeta,\alpha,p'}(q)$ and its gradients.
We use Cannon data sets to evaluate reconstruction
of dihedral angles greater than $90^\circ$.



\begin{figure*}
\centering
\begin{tabular}{cccc}
\includegraphics[width=1.6in]{images/twocubes_mesh.eps} &
\includegraphics[width=1.6in]{images/flange_mesh.eps} &
\includegraphics[width=1.6in]{images/smooth_tip_cone_mesh.eps} &
\includegraphics[width=1.6in]{images/cannon_mesh.eps}
\\
(a) Two cubes. & (b) Flange. & (c) Smooth tip cone. & (d) Cannon. \\
\end{tabular}
\caption{Polyhedral meshes representing level sets.}
\label{fig:mesh}
\end{figure*}


\begin{table*}[t]
\centering
\begin{tabular}{|l||r|c|c|r|r|r|r|}
\hline
              & \centercol{Num} &          & & \centercol{Avg Num} 
                                     & \centercol{Avg Num} 
                                         & \centercol{Avg Num} & \\
Data Set Type & Data Sets & Grid Size & Isovalue & \centercol{Active Cubes} 
                                    & \centercol{Iso Vert} 
                                        & \centercol{Iso Tri} 
                                             & \centercol{Avg Time} \\
\hline
\hline
TwoCubes & 34 & \gDim{150} & 20.1 & 25K & 22K & 45K & 0.8 sec \\
\hline
Flange & 40 & \gDim{200} & 10.1 & & & & \\
\hline
Smooth Tip Cone & 15 & \gDim{100} & 10.2 & & & & \\
\hline
Cannon & 15 & \gDim{100} & 0.0 & & & & \\
\hline
Honda Engine & 1 & $411 \times 431 \times 61$ & & & & & \\
\hline
Volt & 1 & $101 \times 111 \times 61$ & & & & & \\
\hline
CMM & 1 & $500 \times 500 \times 196$ & & & & & \\
\hline
\end{tabular}

\caption{Test data set sizes, isovalues, and average statistics
on isosurfaces produced by SHREC.
Average number of active cubes, 
average number of isosurface vertices,
average number of isosurface triangles,
and average SHREC running time.
All isosurface quadrilaterals are triangulated
before counting the number of isosurface triangles.
Because SHREC merges isosurface vertices, the average number of isosurface
vertices is less than the average number of active cubes.
}

\label{table:datasets}

\end{table*}

\subsection{Gradients}

Algorithm SHREC requires gradients at the grid vertices.
Exact formulas can be given for gradients
for each of the scalar fields described in the previous section.
However, if scalar data is acquired from scanning devices such as CT scanners,
only scalar information is available.
In~\cite{bw-crgsd-15},
we describe an algorithm, Religrad, for constructing a set 
of reliable gradients from scalar data.
We evaluated SHREC both on gradients computed by exact formulas
and on the gradients produced by Religrad from the scalar data.

\subsection{Measurements}

For each test scalar field $f$ and test isovalue $\sigma$,
we constructed a polygonal mesh which represented the level set,
$f^{-1}(\sigma)$.
(See Figure~\ref{fig:mesh}.)
The polygonal mesh was designed specifically for each surface
to accurately represent the 0-dimensonal and 1-dimensional features
on the surface.

To compare isosurfaces constructed by different software on different scales,
we rescaled every isosurface and polygonal mesh to lie in the unit cube.
Our isosurfaces were computed from grids 
of $150 \times 150 \times 150$ or $200 \times 200 \times 200$
so this rescaled the cube size to about $0.005$ units.
We computed the angular distance in the extended neighborhood $\epsilon$
as defined in Section~\ref{section:angular_distance}
between each isosurface and the corresponding polygonal mesh.
We set $\epsilon$ equal to $0.01$ or about twice the cube size
for the extended neighborhood.

We also used the degree test as described in~\cite{bw-cisec-13}
to measure errors in reconstructing sharp features.
We extracted the 1-skeleton of isosurface edges with dihedral angle 
less than $140^\circ$ and counted the number of vertices in the 1-skeleton
with degree other than two.
For an isosurface $\Sigma$,
let $\NneqII(\Sigma)$ be the number of vertices in the 1-skeleton
with degree other than two.
Isosurfaces from the Flange, Smooth Tip Cone and Cannon data sets
should have had zero vertices with degrees other than two.
The number of degree errors for these isosurfaces is $\NneqII(\Sigma)$.
Isosurfaces from the TwoCubes data sets should have had exactly
twenty vertices with degrees other than two.
The number of degree errors for these isosurfaces is $|\NneqII(\Sigma)-20|$.

\begin{figure}[tb]
\includegraphics[width=\linewidth]{images/shrecFlangeCombine2.eps}
\caption{Result of SHREC on a Flange dataset. ``Sharp" edges (with dihedral angle less than $140^\circ$) are marked in red. 
``Smooth" edges are in dark grey. The magnified region shows a blend of the ``sharp" edges with a subset of the ``smooth" edges.}
\label{fig:flange1}
\end{figure}


\begin{figure*}[tp]
\centering	

	\subfloat[]{\includegraphics[width=0.33\linewidth]{images/flangeAngle1b.eps}\label{fig:flangeAngle1}}
	\subfloat[]{\includegraphics[width=0.33\linewidth]{images/flangeAngle2.eps}\label{fig:flangeAngle2}}
	\subfloat[]{\includegraphics[width=0.33\linewidth]{images/flangeAngle3b.eps}\label{fig:flangeAngle3}}

\caption{Results of SHREC using Religrad gradients on 40 Flange datasets. 
(a) Number of triangles with angle difference 
to polygonal mesh above 30, 40 and 50 degrees. 
(b) Angle distribution of test case 16.
which has three triangles over 30 degrees and one above 40
degrees. (Isosurface has approximately $133K$ triangles.)
(c) Number of degree errors in 1-skeleton of sharp edges.
}

\label{fig:flangeAngle}

\vspace{4em}

\begin{tabular}{cc}
\includegraphics[width=0.45\linewidth]{images/tw1.eps} &
\includegraphics[width=0.45\linewidth]{images/tw2.eps} \\
(a) SHREC using exact gradients & (b) SHREC using Religrad gradients \\
\\
\includegraphics[height=0.25\linewidth]{images/tw3.eps} &
\includegraphics[height=0.25\linewidth]{images/twoCube35_test_1.eps} \\
(c) Shrec using Religrad gradients & (d) SHREC using Religrad Gradients
\end{tabular}

\caption{Results of SHREC using exact and Religrad gradients 
on 40 TwoCubes datasets. 
(a) Unoriented angle distance between isosurface (exact gradients)
and polygonal mesh.
(Note that the $y$-scale is from 0 to $10^\circ$.)
(b) Unoriented angle distance between isosurface (Religrad gradients)
and polygonal mesh.
(c)~Number of isosurface triangles (Religrad gradients)
with angle difference to polygonal mesh above 30, 40, 50 degrees.
(d)~Number of degree errors in the 1-skeleton of sharp edges
(Religrad gradients).
(SHREC using exact gradients produces no degree errors.)}
\label{fig:shrecTwoCube}

\end{figure*}


\subsection{Isosurface Reconstruction on Synthetic Data}

We tested SHREC on 40 Flange data sets with 40 different orientations
and 34 TwoCubes data sets with 34 different orientations.
Table~\ref{table:datasets} presents data set sizes, isovalues,
and average isosurface sizes.
We tested SHREC both on gradients produced by exact formulas 
and on gradients produced by ReliGrad.
We measured the unoriented angle distance between the SHREC isosurfaces
and the polygonal meshes representing the level sets.
We also counted the number of isosurface triangles whose normal differences
were above $30^\circ$, $40^\circ$ and $50^\circ$.
Finally, we measured the number of degree errors 
in the 1-skeleton of sharp isosurface edges.

Figure~\ref{fig:flange1} shows a Flange isosurface produced by SHREC
using exact gradients.
The magnified region shows edges with dihedral angle
less than $140^\circ$ in red blended with a subset of the ``non-sharp"
edges.

With exact gradients,
all the Flange isosurfaces had unoriented angle distance
under ??? from the polygonal meshes.
They also had no degree errors in the 1-skeletons
of sharp isosurface edges,
i.e. all the vertices in the 1-skeletons had degree two.

Figure~\ref{fig:flangeAngle} displays angle distance and degree error
information for the 40 Flange isosurfaces
when gradients were produced using Religrad.
As shown in Figure~\subref*{fig:flangeAngle1},
only one isosurface had triangles with angle distance greater than $50^\circ$
and less than half had no triangles with angle distance greater than $40^\circ$.
No isosurfaces had more than 5 triangles with angle distance
greater than $40^\circ$
and no isosurfaces had more than 15 triangles with angle distance greater
than $30^\circ$.

Figure~\subref*{fig:flangeAngle2} displays a histogram of angle distances
for a single Flange isosurface (id 17) 
whose gradients were produced using Religrad.
(Note the logarithmic scale.)
As can be seen,
there are very few triangles with angle distance
greater than $20^\circ$, $30^\circ$ or $40^\circ$.
The isosurface mesh has approximately 133
thousand triangles. 

Figure~\protect\subref*{fig:flangeAngle3} shows the 1-skeleton degree errors
for the 40 Flange isosurfaces when gradients were produced using Religrad.
Thirty two isosurfaces (80$\%$) had no degree errors.
No isosurface had more than eight degree errors.

Figure~\ref{fig:shrecPerfect1} shows a TwoCubes isosurface
and isosurface edges constructed by SHREC.
SHREC reproduces the 0-dimensional features with single mesh vertices
and the 1-dimensional features with a sequence of mesh edges
with dihedral angle $90^\circ$.

Figure~\ref{fig:shrecTwoCube} displays angle distance and degree error
information for the 34 TwoCube isosurfaces produced by SHREC.
Figure~\ref{fig:shrecTwoCube}(a) shows the unoriented angle distance
using exact gradients.
As with the exact gradients in the Flange data sets,
the angle distance is very low (less than $2^\circ$)
for all the isosurfaces.)
With exact gradients, the 34 TwoCubes isosurfaces 
had no 1-skeleton degree errors, 
i.e. they all had exactly 20 vertices with degree three 
in the 1-skeleton of their sharp edges.

Figure~\ref{fig:shrecTwoCube}(b) shows the unoriented angle distances
using gradients produced by Religrad.
For most isosurfaces, the angle distance is still low (under $10^\circ$),
although six isosurfaces have angle distances of between $30^\circ$
and $50^\circ$.
The high angle distances indicate errors in the SHREC reconstruction 
of sharp features.

For the isosurfaces constructed using Religrad gradients,
Figure~\ref{fig:shrecTwoCube}(c) gives
the number of isosurface triangles whose normal differences
are above $30^\circ$, $40^\circ$ and $50^\circ$.
Dataset 16, which had the largest angle distance over all 34 isosurfaces,
has only 5 triangles with normal difference more than 30$^\circ$ 
and a single triangle with normal distance over 40$^\circ$.  

Figure~\ref{fig:shrecTwoCube}(d) shows
the degree errors in the 1-skeleton of sharp edges
when gradients were produced using Religrad.
29 out of the 34 TwoCubes isosurfaces had no degree errors.
Of the 5 isosurfaces with degree errors,
the maximum number of degree errors was four.
As previously noted,
there were no degree errors for any of the 34 TwoCubes isosurfaces
when SHREC used exact gradients.

\begin{figure}[t]
	\includegraphics[width=\linewidth]{images/shrecPerfect.eps}
	\caption{Result of SHREC on a twoCube dataset. ``sharp" edges are marked in red. Smooth edges are shown in cyan. The magnified region shows the output mesh edges around a corner.}
	\label{fig:shrecPerfect1}
\end{figure}

\begin{figure}[t]
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cannon2.eps}\label{fig:cannon:a}}
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cone2.eps}\label{fig:cone:a}}
	\caption{Result of algorithm SHREC with RELIGRAD gradients on Cannon and Cone datasets}
	\label{fig:cannon_cone}
\end{figure}

\begin{figure}[t]
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cannon.eps}\label{fig:cannon:b}}
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/cone.eps}\label{fig:cone:b}}

\caption{Result of SHREC on 15 Cannon and 14 Smooth Tip Cone data sets.
(a) Number of degree errors on 1-skeleton of Cannon isosurfaces
constructed using Religrad gradients.
(Cannon isosurfaces constructed using exact gradients had no degree errors.)
(b) Number of degree errors on 1-skeleton of Smooth Tip Cone isosurfaces
constructed using Religrad gradients (green) and exact gradients 
(red, labelled SHREC+SYNTHETIC GRADIENTS).}
\label{fig:cannon_cone_summary}
\end{figure}

To measure the dihedral angles other than $90^\circ$,
we ran SHREC on 15 Cannon data sets with 15 different orientations
and 14 Smooth Tip Cone data sets with 14 different orientations.
The 1-dimensional features in the Cannon level sets
had dihedral angles of $60^\circ$.
The 1-dimensional features in the Smooth Tip Cone level sets
had dihedral angles of $120^\circ$.
As expected, SHREC produced more errors than on the Flange or TwoCube
data sets, although it still did quite well.

Figure~\ref{fig:cannon_cone} shows Cannon and Smooth Tip Cone isosurfaces
produced by SHREC using Religrad gradients.
In each, the 1-dimensional is represented by a sequence 
of isosurface mesh edges with the appropriate dihedral angles.

Figure~\ref{fig:cannon_cone_summary} gives the number of degree errors
in the 1-skeleton of sharp edges
for Cannon and Smooth Tip Cone isosurfaces.
SHREC using exact gradients produced no degree errors 
on the 15 Cannon data sets.
SHREC using Religrad produced degree errors on only four Cannon data sets.
For each data set, there were exactly two degree errors.
SHREC using exact gradients produced degree errors in only two 
of the Smooth Tip Cone data sets,
one with two errors and one with four.
SHREC using Religrad gradients produced degree errors on 7 out of the 14
Smooth Tip Cone data sets.
The maximum number of degree errors in any Smooth Tip Cone isosurface
was 4.


\section{Comparison with Other Algorithms}
\label{section:comparison}
\paragraph{Comparison with MergeSharp}
%#150
\begin{figure}[htb]
	\centering
	\subfloat[]{\includegraphics[width=0.8\linewidth]{images/mergeSharpvsShrec.eps}\label{fig:mergesharp:a}}\\
	\subfloat[]{\includegraphics[width=0.6\linewidth]{images/mergeSharpvsShrec2.eps}\label{fig:mergesharp:b}}\\
	\subfloat[]{\includegraphics[width=0.6\linewidth]{images/cone_mergesharp.eps}\label{fig:mergesharp:c}}
	\caption{Result of  MERGESHARP and SHREC with synthetic gradients. (a) Summary results of  CountDegree errors of 40 Flange datasets. SHREC does not produce an errors. (b) Result on one particular data set using MERGESHARP, magnified region shows one of the ``notches" created. (c) Apart from ``Notches", MERGESHARP produces gentle dimples which decays the visual quality. Magnified region shows a portion of a Cone dataset (Left) MERGESHARP (Right) SHREC. }
	\label{fig:mergeSharpVShrec}
\end{figure}	
We first compare our algorithm with MERGESHARP~\cite{bw-cisec-13}. MERGESHARP takes as input a scalar volume and the corresponding synthetic gradients at the grid vertices. Figure~\protect\subref*{fig:mergesharp:a} shows the summary of CountDegree results of running MERGESHARP on 40 Flange datasets using synthetic gradients. SHREC as discussed above does not generate any errors with synthetic gradients. Figure~\protect\subref*{fig:mergesharp:b} shows the result on one of the Flange data sets  reconstructed from MERGESHARP. MERGESHARP produces ``notches" such as the one shown in Figure~\protect\subref*{fig:mergesharp:b}.

MERGESHARP also produces gentle dimples such as the ones in the edge of a Cone data set shown in Figure~\protect\subref*{fig:mergesharp:c}, SHREC does not produce them. 	
\paragraph{Comparison with Cocone}
We compare our algorithm to the algorithm WeightCocone by Dey et al.~\cite{Dey2012}. WeightCocone reconstructs a surface with sharp edges and corners from a sampled point cloud. WeightCocone takes two inputs; one contains the point cloud, another is a weighted sampling of feature curves. Weight of the sampling will be used as weight of the protecting balls. WeightCocone generates as output a feature sensitive mesh. 

The feature curve (second input to WeightCocone) is constructed using the algorithm FeatureRecon by Dey et al.~\cite{Dey2013}. FeatureRecon extracts feature curves of a surface. The input is a point cloud sampled on the surface. FeatureRecon has two steps, feature point detection and feature curves reconstruction. 
\paragraph{Experimental details:} The input to FeatureRecon is a point cloud. We tested two different input point cloud;
\begin{enumerate}
	\item We applied Marching Cubes~\cite{lc-mchr3-87} on our datasets Sec.\ref{sec:synData}. The vertices of the mesh generated by the Marching Cubes algorithm are then super-sampled using the Monte Carlo point sampling, to generate a point cloud with approximately sixty-five thousand points.
	\item We super-sampled the synthetic meshes Sec.\ref{sec:synData}, to generate generate a point cloud with approximately sixty-five thousand points.
\end{enumerate}
The two different point clouds are used as input to FeatureRecon to extract the feature curves. 
FeatureRecon has nine separate parameters. Experimentally and also noted by the authors Dey et al.~\cite{Dey2013}, we found FeatureRecon to be heavily reliant on parameter fine tuning. We used the following parameter values for our TwoCube datasets, (as suggest by the authors Dey et al.~\cite{Dey2013}). 
$-t = 25,-fl = 0.04, -cl = 0.06, -dc = 0, -\rho3 = 0.32, -\rho1 = 0.0, -rc = 3$.

The feature curves generated using FeatureRecon along with the super-sampled point cloud is used as input to WeighCocone. For comparison test, we compare the known synthetic mesh with the output of WeightCocone.  
\begin{figure}[t] 
	%dataset t110 reconstructed from perfect mesh 
	\centering 
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/compare_cocone_perfect_mc_a.eps}\label{fig:cocone_img:a}}
		\subfloat[]{\includegraphics[width=0.5\linewidth]{images/compare_cocone_perfect_mc_b.eps}\label{fig:cocone_img:b}}
	%\includegraphics[width=\linewidth]{images/compare_cocone_perfect_mc.eps}
	\caption{Result of WeightCocone reconstruction on a TwoCube dataset. \protect\subref{fig:cocone_img:a} Input cloud is the super-sampled synthetic mesh. \protect\subref{fig:cocone_img:b} Input cloud is the super-sampled Marching Cube mesh. The magnified regions show some of the errors. The reconstruction from point cloud generated from the Marching Cube input is worse than the  point cloud from synthetic mesh input. }
	\label{fig:cocone_compare_from_perfect_1}
	\vskip-0.2cm
\end{figure} 

Figure~\ref{fig:cocone_compare_from_perfect_1} shows the reconstructed mesh for one of our twoCube dataset. The associated ``sharp" edges are also shown. Figure~\ref{fig:cocone_compare_from_perfect_1}(a) shows the reconstruction from the point cloud generated from the synthetic mesh. The overlay-ed ``sharp" edges (in red) show that the reconstruction has many errors. The magnified regions show some of the errors along the sharp edges and corners. Figure~\ref{fig:cocone_compare_from_perfect_1}(b) shows the reconstruction from the point cloud generated from running Marching Cubes. The magnified regions show the same regions as Figure~\ref{fig:cocone_compare_from_perfect_1}(a). The reconstruction is worse than WeightCocone using input from synthetic mesh. 

Figure~\ref{fig:cocone:compare} shows the summary results of running weightCocone and SHREC on 15 different datasets. 
The input to weightCocone  for these tests are generated from synthetic mesh. The results from Marching Cubes input are worse and not shown.
\paragraph{}
On the same 15 datasets, we run SHREC with both synthetic gradients and using RELIGRAD.
Figure~\protect\subref*{fig:cocone:a} shows countDegree error comparison between WeightCocone, SHREC with synthetic gradient and SHREC with gradient computed using RELIGRAD.  SHREC with RELIGRAD generates very few errors; only two testcases (t6 and t13 generate degree errors with a maximum of 4) , while with synthetic gradient no errors are generated. 
In contrast, WeightCocone generates a large number of errors on all the testcases; with an average of 330 errors. Figure~\protect\subref*{fig:cocone:b} shows the maximum surface angle difference from the synthetic mesh for SHREC with RELIGRAD and WeighCocone;
The maximum angle difference is 43$^\circ$ for SHREC, with the mean error of 8$^\circ$ for the 15 tests. In comparison maximum angle difference was 87$^\circ$ for WeightCocone, with a mean of 79$^\circ$.
Figure~\protect\subref*{fig:cocone:c} shows the angle distribution for WeightCocone construction on the 15 testcases. 
On all the test cases there are large number of triangles with angle difference more than 40$^\circ$ and 50$^\circ$.

Above discussion quantitatively shows what we previously observed from  in Figure~\protect\subref*{fig:cocone_img:a},~\protect\subref*{fig:cocone_img:b} and compared to Figure~\ref{fig:flange1},~\ref{fig:shrecPerfect1} i.e sharp edges generated by WeightCocone is in general far worse than those generated by SHREC with synthetic as well as RELIGRAD gradients. 

Dey et al.~\cite{Dey2012,Dey2013} report better results on their datasets, Which might possibly be because of parameter tuning. They themselves acknowledged as such in their work.
\begin{figure*}[htb]
	\centering
		\subfloat[]{\includegraphics[width=0.3\linewidth]{images/cocone_cd_twoCube.eps}\label{fig:cocone:a}}
		\subfloat[]{\includegraphics[width=0.3\linewidth]{images/cocone_max_angle_twoCube.eps}\label{fig:cocone:b}}	
		\subfloat[]{\includegraphics[width=0.3\linewidth]{images/cocone_angle_distri_twoCube.eps}\label{fig:cocone:c}}		
		%\subfloat[]{\includegraphics[width=0.6\linewidth]{images/twoCubeQuant.eps}\label{table:cocone_compare_with_mc_table_1}}
		\caption{Cocone comparison Dey et al.~\cite{Dey2012,Dey2013}.(a) CountDegree errors on 15 datasets using SHREC with synthetic gradients, RELIGRAD and WeightCocone. (b)Max. surface angle difference for the 15 testcases using WeightCocone and SHREC with RELIGRAD(c) Number of triangles with angle difference of 30$^\circ$, 40$^\circ$ and 50$^\circ$ from the original mesh on a subset of 15 datasets using WeightCocone with  input points sampled from the synthetic mesh.}
		\label{fig:cocone:compare}
\end{figure*}
\paragraph{Polymender comparison;}
We next compared SHREC to Polymender. Polymender is an implementation of mesh repairing algorithm from Ju~\cite{j-rrpm-04} availiable at \url{www.cse.wustl.edu/~taoju/code/polymender.htm} \href{http://www.cse.wustl.edu/~taoju/code/polymender.htm}{}. 
We ran the same 34 twocube datasets and the 34 flange dataset using Polymender. 

Figure~\ref{fig:polymenderA} shows the summary results of running Polymender both using CountDegree and surface angle differences.
Figure~\ref{fig:polymenderB} shows qualitative comparison between Polymender and SHREC. 
Figure~\protect\subref*{fig:polymender:a},~\protect\subref*{fig:polymender:b} and ~\protect\subref*{fig:polymender:f} shows the countDegree errors, the maximum surface angle difference from the synthetic mesh and the angle distribution for 34 twoCube datasets respectively. Similarly, 
Figure~\protect\subref*{fig:polymender:c},~\protect\subref*{fig:polymender:d} and ~\protect\subref*{fig:polymender:e} shows the results for the 34 flange datasets. Polymender produces numerous degree errors both in flange and twoCube datasets. The maximum degree error for twoCube datasets, is ~170. At least 3 flange dataset produce over 350 errors. Both Flange and twoCube produce large maximum angle difference errors from the synthetic mesh. The angle distributions show the angle errors are not isolated instead large number of triangles in both the flange and the twoCube datasets have large (over 50$^\circ$) angle difference from the synthetic mesh.    

Figure~\protect\subref*{fig:polymenderB:a} shows part of a flange dataset reconstructed using SHREC and RELIGRAD. Figure~\protect\subref*{fig:polymenderB:b} shows the same region reconstructed using Polymender; note the ``flipped" triangle and distorted ``sharp" line. Figure~\protect\subref*{fig:polymenderB:c} shows the surface angle  difference distribution for the meshes shown in Figure~\protect\subref*{fig:polymenderB:a} and Figure~\protect\subref*{fig:polymenderB:b}; as expected SHREC produces far few large angle difference than Polymender.

Figure~\protect\subref*{fig:polymender:cone:a} shows a Cone dataset reconstructed using SHREC and RELIGRAD. Figure~\protect\subref*{fig:polymender:cone:b} shows the same dataset reconstructed using Polymender. The curved edges are not reconstructed accurately in Polymender. Figure~\protect\subref*{fig:polymender:cone:c} shows a close up comparison of the sharp edge reconstructed from SHREC(right) and Polymender(left). The sharp edge is not preserved when using Polymender.  We used the following parameters to run Polymender; ``octree depth" was set to 7 and ``scale" was set to 0.9 for all tests. Everything else was set to default values. 

\begin{figure*}[htb]
	\centering
		\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/twoCube_summary_2.eps}\label{fig:polymender:a}}\quad
				\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/countDegree_Flange.eps}\label{fig:polymender:c}}\\
		\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/twoCube_summary_1.eps}\label{fig:polymender:b}}\quad
		\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip, width=0.45\linewidth]{images/max_surface_angle_Flange.eps}\label{fig:polymender:d}}\\
			\subfloat[]{\includegraphics[ width=0.49\linewidth]{images/twocube-35-polymender.eps}\label{fig:polymender:f}}\quad
		\subfloat[]{\includegraphics[ width=0.49\linewidth]{images/flange-35-polymender.eps}\label{fig:polymender:e}}\\
		%\subfloat[]{\includegraphics[width=0.3\linewidth]{images/polymender_angle_histogram.eps}\label{fig:polymender:a}}\quad
		%\subfloat[]{\includegraphics[width=0.3\linewidth]{images/polymender_shrec_compare_1.eps}\label{fig:polymender:b}}\quad		
		\caption{Summary results of Polymender.
			~\protect\subref{fig:polymender:a} CountDegree errors for 34 TwoCube datasets.
			~\protect\subref{fig:polymender:c} CountDegree errors for 40 Flange datasets. 
			~\protect\subref{fig:polymender:b} Maximum surface angle difference between Polymender results and perfect mesh for TwoCube data sets.
			~\protect\subref{fig:polymender:d} Maximum surface angle difference between Polymender results and perfect mesh for Flange data sets.
			~\protect\subref{fig:polymender:f} Number of triangles with angle difference above 30, 40, 50$^\circ$ for the twoCube datasets.
			~\protect\subref{fig:polymender:e} Number of triangles with angle difference above 30, 40, 50$^\circ$ for the Flange datasets.}	
		\label{fig:polymenderA}
\end{figure*}
\begin{figure*}
	\centering
			\subfloat[]{\includegraphics[width=0.33\linewidth]{images/polymender3.eps}\label{fig:polymenderB:a}}\quad
			\subfloat[]{\includegraphics[width=0.33\linewidth]{images/polymender4.eps}\label{fig:polymenderB:b}}
			\subfloat[]{\includegraphics[width=0.3\linewidth]{images/polymenderHistogram_1.eps}\label{fig:polymenderB:c}}\\
			\subfloat[]{\includegraphics[width=0.2\linewidth]{images/polymender_cone_merge_1.eps}\label{fig:polymender:cone:a}}\quad
			\subfloat[]{\includegraphics[width=0.2\linewidth]{images/polymender_cone_merge_2.eps}\label{fig:polymender:cone:b}}\quad
			\subfloat[]{\includegraphics[width=0.4\linewidth]{images/polymender_cone_merge_3.eps}\label{fig:polymender:cone:c}}
			\caption{Polymender and SHREC comparison.~\protect\subref{fig:polymenderB:a} shows SHREC on a part of the flange dataset. ~\protect\subref{fig:polymenderB:b} shows Polymender results on the same. Figure~\protect\subref{fig:polymenderB:c} shows the number of triangles with angle comparison between SHREC and Polymender for this dataset. Figure~\protect\subref{fig:polymender:cone:a} Cone dataset using SHREC. Figure~\protect\subref{fig:polymender:cone:b} Cone data set using Polymender. ~\protect\subref{fig:polymender:cone:c} magnified region showing an edge in both. }
					\label{fig:polymenderB}
\end{figure*}
\paragraph{Extended Marching Cubes comparison;}
\begin{figure*}
	\centering
	\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip,height=0.2\linewidth]{images/countDegree_isoex.eps}\label{fig:isoEx_summ:a}}
	\subfloat[]{\includegraphics[trim={5cm 0 5cm 0},clip,height=0.2\linewidth]{images/max_angle_isoex.eps}\label{fig:isoEx_summ:b}}
	\subfloat[]{\includegraphics[height=0.2\linewidth]{images/isoex_surf_angle_dist.eps}\label{fig:isoEx_summ:c}}\\
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/isoExFlange.eps}\label{fig:isoEx:a}}
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/isoExTwoCube.eps}\label{fig:isoEx:b}}\\
	%\subfloat[]{\includegraphics[width=0.45\linewidth]{images/isoex_compare1.eps}\label{fig:isoEx:a}}\quad
	%\subfloat[]{\includegraphics[width=0.45\linewidth]{images/isoEx_compare2.eps}\label{fig:isoEx:b}}
	\caption{Extended Marching Cubes and SHREC comparison.~\protect\subref{fig:isoEx_summ:a} CountDegree comparison for SHREC and extended marching cubes, 
		~\protect\subref{fig:isoEx_summ:b} Maximum surface angle difference for SHREC and extended marching cubes, 
		~\protect\subref{fig:isoEx_summ:c} angle distribution  using extended marching cubes, 
		~\protect\subref{fig:isoEx:a} extended marching cubes on a Flange dataset, ~\protect\subref{fig:isoEx:b} on a TwoCube dataset. The magnified regions shows the errors generated by extended marching cubes.}	
\end{figure*}

We also compare our algorithm to Extended Marching Cubes by Kobbelt et al.~\cite{kbsh-fssev-01}. For this we extended the implementation available at \url{https://www.graphics.rwth-aachen.de/software/} \href{https://www.graphics.rwth-aachen.de/software/}{}, to include twoCube and Flange data types. We ran extended marching cubes on 4 randomly selected twoCube dataset and 4 randomly selected flange dataset. Figure~\protect\subref*{fig:isoEx_summ:a} shows the countDegree results on the test cases using both extended marching cubes and SHREC. SHREC generates no countdegree errors in these testcases, in comparison all test cases using extended marching cubes generate degree errors; with two out of four flange datasets generating more than 50 errors.
Example errors for flange and twoCube are shown in Figure~\protect\subref*{fig:isoEx:a} and Figure~\protect\subref*{fig:isoEx:b} respectively. 

Figure~\protect\subref{fig:isoEx_summ:b} shows the maximum surface angle difference comparison between SHREC and extended marching cubes. The maximum surface angle difference to the synthetic mesh is less than 20$^\circ$ when using SHREC on the Flange datasets, but is around 180$^\circ$ for extended marching cubes due to triangle flipping. Finally, Figure~\protect\subref*{fig:isoEx_summ:c} shows the angle distribution for extended marching cubes on the 15 datasets, the reconstruction generates numerous simpices which are at angles greater than 50 $^\circ$ from the synthetic mesh; all the flange datasets have at least 22 triangles which have more than 50  $^\circ$ difference from the synthetic mesh, with the highest total of 45 triangles above 30 $^\circ$ for flange testcase 1.


Extensive comparison with the state of the art algorithms show that SHREC with both synthetic gradients and gradients computed from RELIGRAD can out-perform these algorithms and reconstruct sharp features effectively. 


\section{Experimental Results on CT Data}
We applied the SHREC algorithm on X-ray computed tomography scans of a number of real industrial datasets. Here we show the results on three of the them. 
Figure~\ref{fig:ict:hondaEng} shows the result of reconstruction on a subset of a Honda Engine data set using SHREC and RELIGRAD. The Honda engine data is $411*431*61$ in dimension. The magnified regions (with black border) show that the sharp edges are well reconstructed. In yellow border boxes, we see magnified parts of the  reconstructed mesh along with the sharp and non-sharp edges generated by SHREC. In red we see an image of the original part which is reconstructed. 


Figure~\ref{fig:ict:volt} shows the result on our Volt dataset; The dimension of the data set is $101*111*61$. Volt is a scan of a generic 440 voltage electrical connector. Once again we see that SHREC along with RELIGRAD is able to reconstruct the sharp (flange-like) curves accurately. Finally, Figure~\ref{fig:ict:CMM} shows a part of our coordinate measuring machine (CMM) data (size $500*500*196$), Figure~\protect\subref*{fig:ict:CMM:a} shows the reconstruction result. Figure~\protect\subref*{fig:ict:CMM:b} shows a single slice of the CT scan, mapped to the ``heat" color map. 

Through these reconstructions and others we have confirmed that SHREC performs well on real industrial CT data sets. 

\begin{figure}\centering
	\includegraphics[width=\linewidth]{images/ictsetA_2.eps}
	\caption{SHREC with RELIGRAD gradients computed from part of industrial CT data (Honda Engine). Magnified regions show ``sharp" edges reconstructed. In red, picture from the original item.}
	\label{fig:ict:hondaEng}
\end{figure}

\begin{figure}\centering
	\includegraphics[width=\linewidth]{images/volt.eps}
	\caption{SHREC with RELIGRAD gradients computed from part of the VOLT data. Magnified regions show ``sharp" reconstructed edges. In red picture of the original item.}
	\label{fig:ict:volt}
\end{figure}

\begin{figure}[htb]
	\centering
	\subfloat[]{\includegraphics[width=\linewidth]{images/cmm.eps}\label{fig:ict:CMM:a}}\\
	\subfloat[]{\includegraphics[width=0.5\linewidth]{images/CMM.singleSliceXY.eps}\label{fig:ict:CMM:b}}
	\caption{(a) SHREC with RELIGRAD gradients computed from part of the CMM dataset. Magnified regions show ``sharp" reconstructed edges. (b) Single slice of the CT scan, mapped to the ``heat" color map.}\label{fig:ict:CMM}
\end{figure}


\subsection{Timings}

